---
title: アプリを Azure 仮想ネットワークと統合する
description: Azure App Service のアプリを Azure 仮想ネットワークと統合します。
author: madsd
ms.topic: conceptual
ms.date: 10/20/2021
ms.author: madsd
ms.openlocfilehash: 2fab79439dd28a889d117bdce5bc4916f3d5b2f8
ms.sourcegitcommit: 591ffa464618b8bb3c6caec49a0aa9c91aa5e882
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/06/2021
ms.locfileid: "131892933"
---
# <a name="integrate-your-app-with-an-azure-virtual-network"></a>アプリを Azure 仮想ネットワークと統合する

この記事では、Azure App Service の VNet 統合機能と、それを [App Service](./overview.md) のアプリで設定する方法について説明します。 [Azure 仮想ネットワーク](../virtual-network/virtual-networks-overview.md) (VNets) では、インターネットでルーティングできないネットワークに、多くの Azure リソースを配置できます。 App Service の VNet 統合機能を使用すると、アプリは仮想ネットワーク内のリソースにアクセスしたり、仮想ネットワークを通じてリソースにアクセスしたりできます。 仮想ネットワーク統合では、アプリにプライベートでアクセスすることはできません。

App Service には、次の 2 つのバリエーションがあります。

[!INCLUDE [app-service-web-vnet-types](../../includes/app-service-web-vnet-types.md)]

[仮想ネットワーク統合を有効にする方法](./configure-vnet-integration-enable.md)を確認する。

## <a name="regional-virtual-network-integration"></a>リージョンでの仮想ネットワーク統合

リージョン仮想ネットワーク統合では、同じリージョン内の仮想ネットワークへの接続がサポートされ、ゲートウェイは不要です。 リージョン仮想ネットワーク統合を使用すると、アプリは次のものにアクセスできるようになります。

* 統合した仮想ネットワーク内のリソース。
* アプリが統合されている仮想ネットワークとピアリングされた仮想ネットワーク内のリソース (グローバル ピアリング接続を含む)。
* Azure ExpressRoute 接続にまたがるリソース。
* サービス エンドポイントでセキュリティ保護されたサービス。
* プライベート エンドポイントが有効なサービス。

リージョン仮想ネットワーク統合を使用している場合は、次の Azure ネットワーク機能を使用できます。

* **ネットワーク セキュリティ グループ (NSG)** :統合サブネットに配置された NSG を使って送信トラフィックをブロックできます。 仮想ネットワーク統合を使ってアプリへの受信アクセスを提供することはできないため、受信規則は適用されません。
* **ルート テーブル (UDR)** :統合サブネット上にルート テーブルを配置して、必要な場所に送信トラフィックを送信できます。

### <a name="how-regional-virtual-network-integration-works"></a>リージョン仮想ネットワーク統合の仕組み

App Service 内のアプリは、worker ロールでホストされます。 リージョン仮想ネットワーク統合は、委任されたサブネット内のアドレスで仮想インターフェイスを worker ロールにマウントすることによって機能します。 統合元のアドレスはお使いの仮想ネットワーク内にあるため、仮想ネットワーク内の VM と同じように、仮想ネットワーク内に存在するか、仮想ネットワークを経由してアクセスできるほとんどのものに、アクセスできます。 ネットワークの実装は、仮想ネットワークで VM を実行する場合とは異なります。 そのため、一部のネットワーク機能はこの機能ではまだ使用できません。

:::image type="content" source="./media/overview-vnet-integration/vnetint-how-regional-works.png" alt-text="リージョン仮想ネットワーク統合の仕組みを示す図。":::

リージョン仮想ネットワーク統合が有効になっている場合、アプリは仮想ネットワークを介して送信呼び出しを行います。 アプリのプロパティ ポータルに一覧表示される送信アドレスは、引き続きそのアプリによって使用されるアドレスです。 ただし、送信呼び出しが、統合仮想ネットワークまたはピアリングされた仮想ネットワーク内の仮想マシンまたはプライベート エンドポイントに対して行われる場合、送信アドレスは統合サブネットのアドレスになります。 インスタンスに割り当てられたプライベート IP は、環境変数 WEBSITE_PRIVATE_IP によって公開されます。

すべてのトラフィックのルーティングを有効にすると、すべての送信トラフィックが仮想ネットワークに送られます。 すべてのトラフィックのルーティングが有効になっていない場合、統合サブネット上で構成されたプライベート トラフィック (RFC1918) とサービス エンドポイントだけが仮想ネットワークに送信され、インターネットへの送信トラフィックは通常と同じチャネルを経由します。

この機能では、worker ごとに 1 つの仮想インターフェイスのみがサポートされます。 worker あたり 1 つの仮想インターフェイスは、App Service プランごとに 1 つのリージョン仮想ネットワーク統合を意味します。 同じ App Service プラン内のすべてのアプリで、同じ仮想ネットワーク統合を使用できます。 アプリで別の仮想ネットワークに接続する必要がある場合は、別の App Service プランを作成する必要があります。 使用される仮想インターフェイスは、顧客が直接アクセスできるリソースではありません。

このテクノロジの動作方法の性質のために、仮想ネットワーク統合で使用されるトラフィックは Azure Network Watcher や NSG フロー ログには表示されません。

### <a name="subnet-requirements"></a>サブネットの要件

仮想ネットワーク統合は、専用サブネットに依存します。 サブネットを作成すると、Azure サブネットから 5 つの IP が減ります。 プラン インスタンスごとに、統合サブネットから 1 つのアドレスが使用されます。 アプリを 4 つのインスタンスにスケールする場合は、4 つのアドレスが使用されます。

サイズをスケールアップまたはスケールダウンすると、必要なアドレス空間が短期間に 2 倍になります。 この変更は、特定のサブネット サイズでサポートされる実際の使用可能なインスタンスに影響します。 次のテーブルに、CIDR ブロック 1 つにつき利用可能なアドレスの最大数と、水平スケーリングに対する影響を示します。

| CIDR ブロック サイズ | 使用可能なアドレスの最大数 | 水平スケールの最大値 (インスタンス)<sup>*</sup> |
|-----------------|-------------------------|---------------------------------|
| /28             | 11                      | 5                               |
| /27             | 27                      | 13                              |
| /26             | 59                      | 29                              |

<sup>*</sup>ある時点でサイズまたは SKU のいずれかでスケールアップまたはスケールダウンする必要があることを前提としています。

割り当てた後はサブネット サイズを変更できないため、アプリが到達する可能性のあるスケールに対応できるだけの十分な大きさを持つサブネットを使用してください。 サブネット容量に関する問題を回避するには、64 個のアドレスを持つ `/26` を使用してください。

お使いのプラン内のアプリが、別のプラン内のアプリから既に接続されている仮想ネットワークにアクセスできるようにする場合は、既存の仮想ネットワーク統合によって使用されているものとは異なるサブネットを選びます。

### <a name="routes"></a>ルート

リージョン仮想ネットワーク統合を構成する場合は、2 種類のルーティングを考慮する必要があります。 アプリケーション ルーティングでは、アプリケーションから仮想ネットワークにルーティングされるトラフィックを定義します。 ネットワーク ルーティングは、トラフィックが仮想ネットワークから送信される方法を制御する機能です。

#### <a name="application-routing"></a>アプリケーション ルーティング

アプリケーション ルーティングを構成するときは、仮想ネットワークにすべてのトラフィックまたはプライベート トラフィック ([RFC1918](https://datatracker.ietf.org/doc/html/rfc1918#section-3) トラフィックとも呼ばれます) のみをルーティングできます。 この動作を構成するには、 **[ルートすべて]** 設定を使用します。 **[ルートすべて]** が無効になっている場合、アプリはプライベート トラフィックのみを仮想ネットワークにルーティングします。 すべての送信トラフィックを仮想ネットワークにルーティングする場合は、 **[ルートすべて]** が有効になっていることを確認してください。

> [!NOTE]
> * **[ルートすべて]** が有効になっている場合、すべてのトラフィックは、統合サブネットに適用された NSG と UDR の対象になります。 すべてのトラフィックのルーティングが有効になっていても、トラフィックを他の場所に送信するルートを指定しない限り、送信トラフィックはアプリのプロパティに一覧表示されているアドレスから送信されます。
> * Windows コンテナーでは、仮想ネットワーク統合での App Service Key Vault 参照とカスタム コンテナー イメージのプルをサポートしていません。
> * リージョン仮想ネットワーク統合ではポート 25 を使用できません。

[アプリケーションのルーティング設定方法](./configure-vnet-integration-routing.md)を学ぶ。

すべてのトラフィックのルーティングを有効にするのために、 **[ルートすべて]** 構成設定を使用することをお勧めします。 この構成設定を使用すると、[組み込みポリシー](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2Fproviders%2FMicrosoft.Authorization%2FpolicyDefinitions%2F33228571-70a4-4fa1-8ca1-26d0aba8d6ef)を使用して動作を監査することができます。 既存の WEBSITE_VNET_ROUTE_ALL アプリ設定を引き続き使用することもでき、どちらの設定でも、すべてのトラフィックのルーティングを有効にすることができます。

#### <a name="network-routing"></a>ネットワーク ルーティング

ルート テーブルを使用して、アプリからの送信トラフィックを任意の場所にルーティングすることができます。 ルート テーブルは、宛先トラフィックに影響します。 [アプリケーションのルーティング](#application-routing)で **[ルートすべて]** が無効になっている場合、ルート テーブルの影響を受けるのはプライベート トラフィック (RFC1918) のみです。 一般的な宛先には、ファイアウォール デバイスまたはゲートウェイを含めることができます。 統合サブネット上に設定されているルートは、受信アプリ要求への応答には影響を与えません。

オンプレミスの発信トラフィックをすべてルーティングする場合は、ルーティング テーブルを使用して、すべての発信トラフィックを Azure ExpressRoute ゲートウェイに送ることができます。 ゲートウェイにトラフィックをルーティングする場合は、外部ネットワークのルートを設定して、応答を返信するようにします。

また、Border Gateway Protocol (BGP) ルートも、アプリのトラフィックに影響を与えます。 ExpressRoute ゲートウェイのようなものから BGP ルートを使用している場合は、アプリの送信トラフィックが影響を受けます。 BGP ルートもユーザー定義のルートと同様に、ルーティング スコープの設定に従ってトラフィックに影響を与えます。

### <a name="network-security-groups"></a>ネットワーク セキュリティ グループ

リージョン仮想ネットワーク統合を使用するアプリでは、[ネットワーク セキュリティ グループ](../virtual-network/network-security-groups-overview.md)を使用して、仮想ネットワークまたはインターネット内のリソースへの送信トラフィックをブロックできます。 パブリック アドレスへのトラフィックをブロックするには、仮想ネットワークへの [[ルートすべて]](#application-routing) を有効にします。 **[ルートすべて]** が有効になっていない場合、NSG は RFC1918 トラフィックにのみ適用されます。

統合サブネットに適用された NSG は、統合サブネットに適用されているルート テーブルに関係なく有効になります。

仮想ネットワーク統合はアプリからの送信トラフィックのみに影響を与えるため、NSG での受信規則はアプリに適用されません。 アプリへの受信トラフィックを制御するには、アクセス制限機能を使用します。

### <a name="service-endpoints"></a>サービス エンドポイント

リージョン仮想ネットワーク統合を使用すると、サービス エンドポイントで保護されている Azure サービスに接続できます。 サービス エンドポイントで保護されたサービスにアクセスするには、次の手順に従います。

1. 統合のための特定のサブネットに接続するために、Web アプリとのリージョン 仮想ネットワーク統合を構成します。
1. 対象のサービスに移動し、統合サブネットに対してサービス エンドポイントを構成します。

### <a name="private-endpoints"></a>プライベート エンドポイント

[プライベート エンドポイント](./networking/private-endpoint.md)を呼び出す場合は、DNS 参照がプライベート エンドポイントに解決されることを確認します。 この動作は、次のいずれかの方法で実現できます。

* Azure DNS プライベート ゾーンと統合する。 仮想ネットワークにカスタム DNS サーバーがない場合は、ゾーンが仮想ネットワークにリンクされたときに自動で統合が実行されます。
* アプリで使用される DNS サーバーでプライベート エンドポイントを管理する。 構成を管理するには、プライベート エンドポイントの IP アドレスを把握している必要があります。 次に、A レコードを使用して、アクセスしようとしているエンドポイントがそのアドレスを指すようにします。
* Azure DNS プライベート ゾーンに転送する独自の DNS サーバーを構成する。

### <a name="azure-dns-private-zones"></a>Azure DNS プライベート ゾーン

仮想ネットワークに統合されたアプリでは、仮想ネットワークが構成されているのと同じ DNS サーバーが使用されます。 カスタム DNS が指定されていない場合は、Azure の既定の DNS と、仮想ネットワークにリンクされているすべてのプライベート ゾーンが使用されます。

### <a name="limitations"></a>制限事項

リージョン仮想ネットワーク統合を使用する場合、いくつかの制限があります。

* この機能は、Premium v2 と Premium v3 のすべての App Service スケール ユニットから使用できます。 また、Standard でも使用できますが、新しい App Service のスケール ユニットからのみ利用できます。 以前のスケール ユニットを使用している場合は、Premium v2 App Service プランからのみ、この機能のみを使用できます。 Standard App Service プランでこの機能を使用できるようにするには、Premium v3 App Service プランでアプリを作成します。 それらのプランは、最新のスケール ユニットでのみサポートされます。 プランを作成した後に、必要に応じてスケールダウンできます。
* この機能は、App Service Environment にある Isolated プランのアプリでは使用できません。
* 従来の仮想ネットワークでは、ピアリング接続でリソースにアクセスすることはできません。
* この機能を使用するには、Azure Resource Manager 仮想ネットワークで、`/28` より大きい IPv4 のブロックからなる未使用のサブネットが必要です。
* アプリと仮想ネットワークが同じリージョンに存在する必要があります。
* 統合仮想ネットワークで IPv6 アドレス空間を定義することはできません。
* 統合サブネットは、1 つの App Service プランでしか使用できません。
* 統合アプリがある仮想ネットワークを削除することはできません。 仮想ネットワークを削除する前に、統合を削除してください。
* App Service プランごとに 1 つのリージョン仮想ネットワーク統合のみを使用できます。 同じ App Service プラン内の複数のアプリによって、同じ仮想ネットワークを使用できます。
* リージョン仮想ネットワーク統合を使用しているアプリがあるときに、アプリまたはプランのサブスクリプションを変更することはできません。

## <a name="gateway-required-virtual-network-integration"></a>ゲートウェイが必要な仮想ネットワーク統合

ゲートウェイが必要な仮想ネットワーク統合では、別のリージョンの仮想ネットワークまたはクラシック仮想ネットワークへの接続がサポートされています。 ゲートウェイが必要な仮想ネットワーク統合:

* アプリでは一度に 1 つの仮想ネットワークにのみ接続できます。
* App Service プランで、最大 5 つの仮想ネットワークと統合できます。
* App Service プランで使用できる総数に影響を与えることなく、App Service プラン内の複数のアプリで同じ仮想ネットワークを使用できます。 同じ App Service プラン内の同じ仮想ネットワークを使用しているアプリが 6 つある場合、使用されている仮想ネットワークは 1 つとしてカウントされます。
* ゲートウェイの SLA は、[SLA](https://azure.microsoft.com/support/legal/sla/) 全体に影響を与える可能性があります。
* アプリでは仮想ネットワークが構成されている DNS を使用できます。
* アプリに接続するには、SSTP ポイント対サイト VPN を設定した仮想ネットワーク ルートベース ゲートウェイが必要です。

次の場合、ゲートウェイが必要な仮想ネットワーク統合は使用できません。

* ExpressRoute で接続された仮想ネットワークに対して。
* Linux アプリから。
* [Windows コンテナー](./quickstart-custom-container.md)から。
* サービス エンドポイントによって保護されているリソースにアクセスする場合。
* ExpressRoute とポイント対サイトまたはサイト間 VPN の両方をサポートする共存ゲートウェイに対して。

### <a name="set-up-a-gateway-in-your-azure-virtual-network"></a>Azure 仮想ネットワークでゲートウェイを設定する

ゲートウェイを作成するには:

1. [VPN ゲートウェイとサブネットを作成します](../vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal.md#creategw)。 VPN の種類はルート ベースを選択します。

1. [ポイント対サイト アドレスを設定](../vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal.md#addresspool)します。 ゲートウェイが Basic SKU 内にない場合は、ポイント対サイトの構成で IKEV2 を無効にする必要があり、SSTP を選択する必要があります。 ポイント対サイトのアドレス空間は、RFC 1918 のアドレス ブロック 10.0.0.0/8、172.16.0.0/12、192.168.0.0/16 内に存在する必要があります。

ゲートウェイが必要な仮想ネットワーク統合で使用するゲートウェイを作成するときは、証明書をアップロードする必要はありません。 ゲートウェイの作成には 30 分かかることがあります。 ゲートウェイが作成されるまで、アプリを仮想ネットワークに統合することはできません。

### <a name="how-gateway-required-virtual-network-integration-works"></a>ゲートウェイが必要な仮想ネットワーク統合の仕組み

ゲートウェイが必要な仮想ネットワーク統合は、ポイント対サイト VPN テクノロジに基づいて構築されています。 ポイント対サイト VPN により、ネットワーク アクセスはアプリがホストされている仮想マシンに制限されます。 アプリからインターネットへのトラフィックの送信は、ハイブリッド接続または仮想ネットワーク統合経由にのみ制限されます。 ゲートウェイが必要な仮想ネットワーク統合を使用するようにアプリをポータルで構成すると、ゲートウェイとアプリケーション側で証明書を作成して割り当てるための複雑なネゴシエーションが、ユーザーの代わりに管理されます。 結果として、アプリをホストするために使用される worker は、選択した仮想ネットワーク内の仮想ネットワーク ゲートウェイに直接接続できます。

:::image type="content" source="./media/overview-vnet-integration/vnetint-how-gateway-works.png" alt-text="ゲートウェイが必要な仮想ネットワーク統合の仕組みを示す図。":::

### <a name="access-on-premises-resources"></a>オンプレミスのリソースにアクセスする

アプリでは、サイト間接続がある仮想ネットワークと統合することで、オンプレミスのリソースにアクセスできます。 ゲートウェイが必要な仮想ネットワーク統合を使用する場合は、ポイント対サイト アドレス ブロックでオンプレミスの VPN ゲートウェイのルートを更新します。 サイト間 VPN が初めてセットアップされるときには、その構成に使用するスクリプトによって、ルートが正しくセットアップされるはずです。 サイト間 VPN を作成した後にポイント対サイト アドレスを追加する場合は、ルートを手動で更新する必要があります。 その詳しい方法はゲートウェイごとに異なるため、ここでは説明しません。 BGP をサイト間 VPN 接続で構成することはできません。

仮想ネットワーク経由でオンプレミスのリソースにアクセスするために、リージョン仮想ネットワーク統合機能に対する追加の構成は必要ありません。 必要なのは、単に ExpressRoute またはサイト間 VPN を使用して仮想ネットワークをオンプレミスのリソースに接続することだけです。

> [!NOTE]
> ゲートウェイが必要な仮想ネットワーク統合機能では、アプリは ExpressRoute ゲートウェイを含む仮想ネットワークとは統合されません。 ExpressRoute ゲートウェイが[共存モード](../expressroute/expressroute-howto-coexist-resource-manager.md)で構成されている場合であっても、仮想ネットワーク統合は機能しません。 ExpressRoute 接続経由でリソースにアクセスする必要がある場合は、仮想ネットワークで実行されるリージョン仮想ネットワーク統合機能または [App Service Environment](./environment/intro.md) を使用します。

### <a name="peering"></a>ピアリング

リージョン仮想ネットワーク統合でピアリングを使用する場合、それ以上の構成を行う必要はありません。

ゲートウェイが必要な仮想ネットワーク統合でピアリングを使用する場合は、いくつかの追加の項目を構成する必要があります。 アプリで動作するようにピアリングを構成するには:

1. アプリの接続先の仮想ネットワークでピアリング接続を追加します。 ピアリング接続を追加するときに、 **[仮想ネットワークアクセスを許可する]** を有効にして、 **[転送されたトラフィックを許可する]** チェック ボックスと **[ゲートウェイ転送を許可する]** チェック ボックスをオンにします。
1. 接続先の仮想ネットワークとピアリングする仮想ネットワークにピアリング接続を追加します。 対象の仮想ネットワークでピアリング接続を追加するときは、 **[仮想ネットワークアクセスを許可する]** を有効にして、 **[転送されたトラフィックを許可する]** チェック ボックスと **[Allow remote gateways]\(リモート ゲートウェイを許可する)** チェック ボックスをオンにします。
1. ポータルで **[App Service プラン]**  >  **[ネットワーク]**  >  **[VNet 統合]** に移動します。 アプリの接続先の仮想ネットワークを選択します。 ルーティングのセクションで、アプリの接続先の仮想ネットワークとピアリングされている仮想ネットワークのアドレス範囲を追加します。

## <a name="manage-virtual-network-integration"></a>仮想ネットワーク統合を管理する

仮想ネットワークとの接続および切断は、アプリ レベルで行われます。 複数のアプリで仮想ネットワーク統合に影響する可能性がある操作は、App Service プラン レベルで行われます。 アプリの **[ネットワーク]**  >  **[VNet 統合]** ポータルから、仮想ネットワークに関する詳細を取得できます。 **[App Service プラン]**  >  **[ネットワーク]**  >  **[VNet 統合]** ポータルの App Service プラン レベルでも、同様の情報が表示されます。

仮想ネットワーク統合インスタンスのアプリ ビューで実行できる操作は、現在接続されている仮想ネットワークからアプリを切断する操作のみです。 仮想ネットワークからアプリを切断するには、 **[切断]** を選択します。 仮想ネットワークから切断すると、アプリが再起動されます。 切断によって仮想ネットワークが変更されることはありません。 サブネットやゲートウェイは削除されません。 その後で仮想ネットワークを削除する必要がある場合は、まず仮想ネットワークからアプリを切断し、ゲートウェイなどのそこに含まれているリソースを削除します。

App Service プランの仮想ネットワーク統合の UI には、App Service プラン内のアプリによって使用されているすべての仮想ネットワーク統合が表示されます。 各仮想ネットワークの詳細を表示するには、目的の仮想ネットワークを選択します。 ここでは、ゲートウェイが必要な仮想ネットワーク統合に対して実行できる操作が 2 つあります。

* **ネットワークを同期する**: ネットワークの同期操作は、ゲートウェイが必要な仮想ネットワーク統合機能でのみ使用されます。 ネットワークの同期操作を実行すると、証明書とネットワーク情報が同期されます。仮想ネットワークの DNS を追加または変更する場合は、ネットワークの同期操作を実行します。 この操作では、この仮想ネットワークを使用するすべてのアプリが再起動されます。 別のサブスクリプションに属しているアプリと仮想ネットワークを使用している場合、この操作は機能しません。
* **ルートを追加する**: ルートを追加すると、送信トラフィックが仮想ネットワークに転送されます。

インスタンスに割り当てられたプライベート IP は、環境変数 WEBSITE_PRIVATE_IP によって公開されます。 Kudu コンソールの UI にも、Web アプリで使用できる環境変数の一覧が表示されます。 この IP は、統合されたサブネットのアドレス範囲から割り当てられます。 リージョン仮想ネットワーク統合の場合、WEBSITE_PRIVATE_IP の値は、委任されたサブネットのアドレス範囲の IP になります。 ゲートウェイが必要な仮想ネットワーク統合の場合、この値は、仮想ネットワーク ゲートウェイに構成されているポイント対サイト アドレス プールのアドレス範囲の IP になります。 この IP は、Azure 仮想ネットワークを通じてリソースに接続するために Web アプリで使用されます。

> [!NOTE]
> WEBSITE_PRIVATE_IP の値は、必ず変更されます。 ただし、これは統合サブネットまたはポイント対サイトのアドレス範囲内の IP であるため、アドレス範囲全体からのアクセスを許可する必要があります。
>

### <a name="gateway-required-virtual-network-integration-routing"></a>ゲートウェイが必要な仮想ネットワーク統合のルーティング

仮想ネットワークで定義されているルートが、アプリから仮想ネットワークにトラフィックを転送するために使用されます。 仮想ネットワークに追加の送信トラフィックを送信するには、ここでそれらのアドレス ブロックを追加します。 この機能は、ゲートウェイが必要な仮想ネットワーク統合でのみ動作します。 ゲートウェイが必要な仮想ネットワーク統合を使用すると、リージョン仮想ネットワーク統合の場合とは異なり、ルート テーブルによるアプリのトラフィックへの影響はありません。

### <a name="gateway-required-virtual-network-integration-certificates"></a>ゲートウェイが必要な仮想ネットワーク統合の証明書

ゲートウェイが必要な仮想ネットワーク統合が有効になっている場合は、接続のセキュリティを確保するために証明書の交換が必要です。 証明書と共に、DNS の構成、ルート、ネットワークについて記述するその他の同様の情報があります。

証明書またはネットワーク情報が変更された場合は、 **[ネットワークの同期]** を選択します。 **[ネットワークの同期]** を選択すると、アプリと仮想ネットワークの間の接続が短時間途切れます。 アプリは再起動されませんが、接続が切れることによって、サイトが正常に機能しなくなる可能性があります。

## <a name="pricing-details"></a>価格の詳細

リージョン仮想ネットワーク統合機能には、App Service プランの価格レベルの料金を超える追加の使用料金はありません。

ゲートウェイが必要な仮想ネットワーク統合機能の使用には、3 つの料金が関連します。

* **App Service プランの価格レベルの料金**: アプリは、Standard、Premium、Premium v2、または Premium v3 の App Service プランに属している必要があります。 コストについて詳しくは、「[App Service の価格](https://azure.microsoft.com/pricing/details/app-service/)」をご覧ください。
* **データ転送コスト**: 仮想ネットワークが同じデータ センター内にある場合でも、データのエグレスには料金がかかります。 それらの料金については、[データ転送価格の詳細](https://azure.microsoft.com/pricing/details/data-transfers/)に関するページをご覧ください。
* **VPN Gateway のコスト**: ポイント対サイト VPN に必要な仮想ネットワーク ゲートウェイに対して費用がかかります。 詳細については、「[VPN Gateway の価格](https://azure.microsoft.com/pricing/details/vpn-gateway/)」を参照してください。

## <a name="troubleshooting"></a>トラブルシューティング

> [!NOTE]
> 仮想ネットワーク統合は、App Service の Docker Compose シナリオではサポートされていません。
> プライベート エンドポイントが存在する場合、アクセス制限は無視されます。

[!INCLUDE [app-service-web-vnet-troubleshooting](../../includes/app-service-web-vnet-troubleshooting.md)]
