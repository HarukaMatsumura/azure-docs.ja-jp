---
title: Azure Private Link を使用した Azure Cache for Redis (プレビュー)
description: Azure プライベート エンドポイントは、Azure Private Link を使用した Azure Cache for Redis にプライベートかつ安全に接続するネットワーク インターフェイスです。 この記事では、Azure portal を使用して Azure Cache、Azure 仮想ネットワーク、プライベート エンドポイントを作成する方法について学習します。
author: curib
ms.author: cauribeg
ms.service: cache
ms.topic: conceptual
ms.date: 10/14/2020
ms.openlocfilehash: 93a21b627acfb127c98ead465ebeadc8a472bdfd
ms.sourcegitcommit: 7dacbf3b9ae0652931762bd5c8192a1a3989e701
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/16/2020
ms.locfileid: "92122706"
---
# <a name="azure-cache-for-redis-with-azure-private-link-public-preview"></a>Azure Private Link を使用した Azure Cache for Redis (パブリック プレビュー)
この記事では、Azure portal を使用して、仮想ネットワークと、プライベート エンドポイントを利用する Azure Cache for Redis インスタンスを作成する方法について学習します。 また、既存の Azure Cache for Redis インスタンスにプライベート エンドポイントを追加する方法について学習します。

Azure プライベート エンドポイントは、Azure Private Link を使用した Azure Cache for Redis にプライベートかつ安全に接続するネットワーク インターフェイスです。 

## <a name="prerequisites"></a>前提条件
* Azure サブスクリプション -  [無料アカウントを作成します](https://azure.microsoft.com/free/)

> [!IMPORTANT]
> プライベート エンドポイントを使用するには、Azure Cache for Redis インスタンスが 2020 年 7 月 28 日より後に作成されている必要があります。
> 現在、geo レプリケーション、ファイアウォール規則、ポータル コンソールのサポート、クラスター化されたキャッシュごとの複数のエンドポイント、ファイアウォールと VNet の挿入されたキャッシュの永続化はサポートされていません。 
>
>

## <a name="create-a-private-endpoint-with-a-new-azure-cache-for-redis-instance"></a>新しい Azure Cache for Redis インスタンスを使用してプライベート エンドポイントを作成する 

このセクションでは、プライベート エンドポイントを利用する新しい Azure Cache for Redis インスタンスを作成します。

### <a name="create-a-virtual-network"></a>仮想ネットワークの作成 

1. [Azure Portal](https://portal.azure.com) にサインインし、 **[リソースの作成]** を選択します。

    :::image type="content" source="media/cache-private-link/1-create-resource.png" alt-text="[リソースの作成] を選択します。":::

2. **[新規]** ページで、 **[ネットワーク]** を選択してから、 **[仮想ネットワーク]** を選択します。

3. **[追加]** を選択して仮想ネットワークを作成します。

4. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

   | 設定      | 推奨値  | 説明 |
   | ------------ |  ------- | -------------------------------------------------- |
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | この仮想ネットワークを作成するサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中に仮想ネットワークやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **名前** | 仮想ネットワーク名を入力します。 | 名前は先頭が文字または数字、末尾が文字、数字、アンダースコアでなければならず、中に含めることができるのは文字、数字、アンダースコア、ピリオド、ハイフンのみです。 | 
   | **リージョン** | ドロップ ダウンでリージョンを選択します。 | 仮想ネットワークを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |

5. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンをクリックします。

6. **[IP アドレス]** タブで、 **[IPv4 アドレス空間]** を、CIDR 表記で 1 つまたは複数のアドレス プレフィックスとして指定します (例: 192.168.1.0/24)。

7. **[サブネット名]** で、 **[既定]** をクリックしてサブネットのプロパティを編集します。

8. **[サブネットの編集]** ペインで、 **[サブネット名]** と **[サブネットのアドレス範囲]** を指定します。 サブネットのアドレス範囲は CIDR 表記である必要があります (例: 192.168.1.0/24)。 仮想ネットワークのアドレス空間に含まれている必要があります。

9. **[保存]** を選択します。

10. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンをクリックします。

11. すべての情報が正しいことを確認し、 **[作成]** をクリックして仮想ネットワークをプロビジョニングします。

### <a name="create-an-azure-cache-for-redis-instance-with-a-private-endpoint"></a>プライベート エンドポイントを利用する Azure Cache for Redis インスタンスを作成する
キャッシュ インスタンスを作成するには、これらの手順に従います。

1. Azure portal ホームページに戻るか、サイドバー メニューを開き、 **[リソースの作成]** を選択します。 
   
1. **[新規]** ページで、 **[データベース]** を選択し、 **[Azure Cache for Redis]** を選択します。

    :::image type="content" source="media/cache-private-link/2-select-cache.png" alt-text="[リソースの作成] を選択します。" は、 *\<DNS name>.redis.cache.windows.net* になります。 | 
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | この新しい Azure Cache for Redis インスタンスが作成されるサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中にキャッシュやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **場所** | ドロップ ダウンで場所を選択します。 | キャッシュを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |
   | **価格レベル** | ドロップ ダウンで[価格レベル](https://azure.microsoft.com/pricing/details/cache/)を選択します。 |  価格レベルによって、キャッシュに使用できるのサイズ、パフォーマンス、および機能が決まります。 詳細については、[Azure Cache for Redis の概要](cache-overview.md)に関するページを参照してください。 |

1. **[ネットワーク]** タブを選択するか、ページの下部にある **[ネットワーク]** ボタンをクリックします。

1. **[ネットワーク]** タブで、接続方法として **[プライベート エンドポイント]** を選択します。

1. **[追加]** ボタンをクリックして、プライベート エンドポイントを作成します。

    :::image type="content" source="media/cache-private-link/3-add-private-endpoint.png" alt-text="[リソースの作成] を選択します。":::

1. **[プライベート エンドポイントの作成]** ページで、前のセクションで作成した仮想ネットワークとサブネットを使用してプライベート エンドポイントの設定を構成し、 **[OK]** を選択します。 

1. **[次へ: 詳細]** タブを選択するか、ページの下部にある **[次へ: 詳細]** ボタンをクリックします。

1. Basic または Standard のキャッシュ インスタンスの **[詳細]** タブで、非 TLS ポートを有効にする場合は有効トグルをオンにします。

1. Premium キャッシュ インスタンスの **[詳細]** タブで、非 TLS ポート、クラスタリング、データ永続化の設定を構成します。


1. **[次へ: タグ]** タブを選択するか、ページの下部にある **[次へ: タグ]** ボタンをクリックします。

1. 必要に応じて、 **[タグ]** タブで、リソースを分類する場合は名前と値を入力します。 

1.  **[確認および作成]** を選択します。 [確認および作成] タブが表示され、Azure によって構成が検証されます。

1. 緑色の検証に成功のメッセージが表示された後、 **[作成]** を選択します。

キャッシュが作成されるまで、しばらく時間がかかります。 Azure Cache for Redis の **[概要]**  ページで進行状況を監視できます。  **[状態]**  に **[実行中]** と表示されている場合は、キャッシュを使用する準備ができています。 
    
> [!IMPORTANT]
> 
> `publicNetworkAccess` フラグは既定で `Enabled` に設定されています。 
> このフラグは、パブリック エンドポイントとプライベート エンドポイントの両方に対してキャッシュへのアクセスを必要に応じて許可できるようにするためにあります (`Enabled` に設定されている場合)。 `Disabled` に設定すると、プライベート エンドポイントのアクセスのみが許可されます。 この値を `Disabled` に設定するには、次の PATCH 要求を使用します。
> ```http
> PATCH  https://management.azure.com/subscriptions/{subscription}/resourceGroups/{resourcegroup}/providers/Microsoft.Cache/Redis/{cache}?api-version=2020-06-01
> {    "properties": {
>        "publicNetworkAccess":"Disabled"
>    }
> }
> ```
>

> [!IMPORTANT]
> 
> クラスター化されたキャッシュに接続するには、`publicNetworkAccess` を `Disabled` に設定する必要があり、プライベート エンドポイント接続は 1 つしか保持できません。 
>

## <a name="create-a-private-endpoint-with-an-existing-azure-cache-for-redis-instance"></a>既存の Azure Cache for Redis インスタンスを使用してプライベート エンドポイントを作成する 

このセクションでは、既存の Azure Cache for Redis インスタンスにプライベート エンドポイントを追加します。 

### <a name="create-a-virtual-network"></a>仮想ネットワークの作成 
仮想ネットワークを作成するには、これらの手順に従います。

1. [Azure Portal](https://portal.azure.com) にサインインし、 **[リソースの作成]** を選択します。

2. **[新規]** ページで、 **[ネットワーク]** を選択してから、 **[仮想ネットワーク]** を選択します。

3. **[追加]** を選択して仮想ネットワークを作成します。

4. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

   | 設定      | 推奨値  | 説明 |
   | ------------ |  ------- | -------------------------------------------------- |
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | この仮想ネットワークを作成するサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中に仮想ネットワークやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **名前** | 仮想ネットワーク名を入力します。 | 名前は先頭が文字または数字、末尾が文字、数字、アンダースコアでなければならず、中に含めることができるのは文字、数字、アンダースコア、ピリオド、ハイフンのみです。 | 
   | **リージョン** | ドロップ ダウンでリージョンを選択します。 | 仮想ネットワークを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |

5. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンをクリックします。

6. **[IP アドレス]** タブで、 **[IPv4 アドレス空間]** を、CIDR 表記で 1 つまたは複数のアドレス プレフィックスとして指定します (例: 192.168.1.0/24)。

7. **[サブネット名]** で、 **[既定]** をクリックしてサブネットのプロパティを編集します。

8. **[サブネットの編集]** ペインで、 **[サブネット名]** と **[サブネットのアドレス範囲]** を指定します。 サブネットのアドレス範囲は CIDR 表記である必要があります (例: 192.168.1.0/24)。 仮想ネットワークのアドレス空間に含まれている必要があります。

9. **[保存]** を選択します。

10. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンをクリックします。

11. すべての情報が正しいことを確認し、 **[作成]** をクリックして仮想ネットワークをプロビジョニングします。

### <a name="create-a-private-endpoint"></a>プライベート エンドポイントの作成 

プライベート エンドポイントを作成するには、これらの手順に従います。

1. Azure portal で、 **Azure Cache for Redis** を検索し、Enter キーを押すか、検索候補からそれを選択します。

    :::image type="content" source="media/cache-private-link/4-search-for-cache.png" alt-text="[リソースの作成] を選択します。":::

2. プライベート エンドポイントを追加するキャッシュ インスタンスを選択します。

3. 画面の左側で、 **[(PREVIEW) Private Endpoint]\((プレビュー) プライベート エンドポイント\)** を選択します。

4. **[プライベート エンドポイント]** ボタンをクリックして、プライベート エンドポイントを作成します。

    :::image type="content" source="media/cache-private-link/5-add-private-endpoint.png" alt-text="[リソースの作成] を選択します。":::

5. **[プライベート エンドポイントの作成] ページ** で、プライベート エンドポイントの設定を構成します。

   | 設定      | 推奨値  | 説明 |
   | ------------ |  ------- | -------------------------------------------------- |
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | このプライベート エンドポイントを作成するサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中にプライベート エンドポイントやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **名前** | プライベート エンドポイント名を入力します。 | 名前は先頭が文字または数字、末尾が文字、数字、アンダースコアでなければならず、中に含めることができるのは文字、数字、アンダースコア、ピリオド、ハイフンのみです。 | 
   | **リージョン** | ドロップ ダウンでリージョンを選択します。 | プライベート エンドポイントを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |

6. **[次へ:リソース]** ボタンを選択します。

7. **[リソース]** タブで、該当するサブスクリプションを選択し、リソースの種類として [`Microsoft.Cache/Redis`] を選んでから、プライベート エンドポイントを接続するキャッシュを選択します。

8. **[次へ:構成]** ボタンを選択します。

9. **[構成]** タブで、前のセクションで作成した仮想ネットワークとサブネットを選択します。

10. **[次へ:タグ]** ボタンを選択します。

11. 必要に応じて、 **[タグ]** タブで、リソースを分類する場合は名前と値を入力します。

12.  **[確認および作成]** を選択します。  **[確認および作成]**   タブが表示され、Azure によって構成が検証されます。

13. 緑色の **検証に成功** のメッセージが表示された後、 **[作成]** を選択します。


## <a name="next-steps"></a>次の手順

Azure Private Link の詳細については、[Azure Private Link のドキュメント](https://docs.microsoft.com/azure/private-link/private-link-overview)を参照してください。 

