---
title: Web サイトの可用性と応答性を監視する - Azure Monitor
description: Application Insights で ping テストを設定します。 Web サイトが使用できなくなったり、応答速度が低下したりした場合に、アラートを受け取ります。
ms.topic: conceptual
ms.date: 04/15/2021
ms.reviewer: sdash
ms.openlocfilehash: 60698862e26175425221940a4b69867cb414fe86
ms.sourcegitcommit: 950e98d5b3e9984b884673e59e0d2c9aaeabb5bb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/18/2021
ms.locfileid: "107598875"
---
# <a name="monitor-the-availability-of-any-website"></a>任意の Web サイトの可用性を監視する

"URL ping テスト" という名前は、少し間違っています。 明確に言うと、このテストでは、サイトの可用性をチェックするために ICMP (インターネット制御メッセージ プロトコル) を使用しません。 代わりに、より高度な HTTP 要求機能を使用して、エンドポイントが応答しているかどうかが検証されます。 また、その応答に関連付けられているパフォーマンスも測定され、依存する要求の解析などの高度な機能と結合されたカスタム成功基準を設定する機能が追加されて、再試行が可能になります。

可用性テストを作成するには、既存の Application insights リソースを使用するか、[Application Insights リソースを作成](create-new-resource.md)する必要があります。

最初の可用性要求を作成するには、[可用性] ウィンドウを開き、  **[テストの作成]** を選択します。

:::image type="content" source="./media/monitor-web-app-availability/availability-create-test-001.png" alt-text="[テストの作成] のスクリーンショット。":::

## <a name="create-a-test"></a>テストを作成する

|設定| 説明
|----|----|----|
|**URL** |  [URL] にはテストする任意の Web ページを指定できますが、パブリック インターネットからアクセス可能である必要があります。 URL にはクエリ文字列を含めることができます。 したがって、たとえば限られた範囲でデータベースを実行できます。 URL が解決されてリダイレクトする場合、それに続いて最大で 10 個リダイレクトを使用できます。|
|**依存する要求の解析**| テストでは、テスト対象の Web ページの一部である画像、スクリプト、スタイル ファイル、およびその他のファイルが要求されます。 記録される応答時間には、これらのファイルの取得にかかる時間が含まれます。 テスト全体のタイムアウト時間内にこれらすべてのリソースを正常にダウンロードできない場合、テストは失敗します。 このオプションがオンになっていない場合、テストからは指定した URL にあるファイルのみが要求されます。 このオプションを有効にすると、より厳密なチェックが行われます。 サイトを手動で参照しているときは気付かないことが原因でテストが失敗する場合があります。
|**再試行を有効にする**|テストが失敗した場合に、少し間を置いてテストを再試行します。 エラーは試行が 3 回連続で失敗した場合にのみ報告されます。 その後、後続のテストが通常のテスト間隔で実行されます。 再試行は、次の成功まで一時的に中断されます。 このルールがテスト場所ごとに独立して適用されます。 **このオプションはオンにすることをお勧めします**。 再試行の際に平均でエラーの約 80% がなくなります。|
|**テスト間隔**| 各テストの場所からテストを実行する頻度を設定します。 既定の間隔が 5 分で、テストの場所が 5 か所の場合、サイトは平均して毎分テストされます。|
|**テストの場所**| 指定の URL にサーバーによって Web 要求が送信される送信元の場所です。 Web サイトの問題とネットワークの問題とを確実に区別するために、**最低でもテストの場所を 5 か所にすることが推奨されます**。 最大 16 個の場所を選択できます。

**パブリック インターネットから指定の URL にアクセスできない場合は、テスト トランザクションのみが通過できるようにお使いのファイアウォールを選択的に開くことを選択できます**。 可用性テスト エージェント用のファイアウォールの例外について詳しくは、[IP アドレス ガイド](./ip-addresses.md#availability-tests)を参照してください。

> [!NOTE]
> 複数の場所 (**少なくとも 5 か所**) からテストを行うことを強くお勧めします。 これにより、特定の場所での一時的な問題による誤検知を防止します。 さらに、**テストの場所の数をアラートの場所のしきい値 + 2** にすると最適な構成になることがわかっています。

## <a name="success-criteria"></a>成功の基準

|設定| 説明
|----|----|----|
| **テストのタイムアウト** |この値を引き下げると、応答が遅い場合に警告されます。 テストは、この期間内にサイトから応答が返されない場合に、エラーとしてカウントされます。 **[従属要求の解析]** をオンにした場合、すべての画像、スタイル ファイル、スクリプト、その他依存するリソースがこの期間内に受信される必要があります。|
| **HTTP 応答** | 成功としてカウントされる、返される状態コード。 200 は、通常の Web ページが返されたことを示すコードです。|
| **コンテンツの一致** | "Welcome!" などの文字列。 それぞれの応答に大文字小文字を区別した完全一致があるかどうかをテストします。 文字列は、(ワイルドカードを含まない) プレーン文字列である必要があります。 ページ コンテンツが変更された場合は、この文字列も更新する必要がある可能性があることに注意してください。 **コンテンツの一致では、英語のみがサポートされています。** |

## <a name="alerts"></a>警告

|設定| 説明
|----|----|----|
|**準リアルタイム (プレビュー)** | 準リアルタイムのアラートを使用することが推奨されます。 この種類のアラートの構成は、可用性テストの作成後に実行されます。  |
|**アラートの場所のしきい値**|少なくとも 3/5 の場所にすることをお勧めします。 アラートの場所のしきい値とテストの場所の数の最適な関係は、**アラートの場所のしきい値** = **テストの場所の数** - 2 です。テストの場所は、少なくとも 5 か所にします。|

## <a name="location-population-tags"></a>位置情報の作成タグ

Azure Resource Manager を使用して可用性 URL の ping テストをデプロイするときに、次の作成タグを位置情報属性に使用できます。

### <a name="azure-gov"></a>Azure gov

| 表示名   | 作成名     |
|----------------|---------------------|
| USGov バージニア州 | usgov-va-azr        |
| USGov アリゾナ  | usgov-phx-azr       |
| USGov テキサス    | usgov-tx-azr        |
| USDoD 東部     | usgov-ddeast-azr    |
| USDoD 中部  | usgov-ddcentral-azr |

#### <a name="azure"></a>Azure

| 表示名                           | 作成名   |
|----------------------------------------|-------------------|
| オーストラリア東部                         | emea-au-syd-edge  |
| ブラジル南部                           | latam-br-gru-edge |
| 米国中部                             | us-fl-mia-edge    |
| 東アジア                              | apac-hk-hkn-azr   |
| 米国東部                                | us-va-ash-azr     |
| フランス南部 (旧名フランス中部) | emea-ch-zrh-edge  |
| フランス中部                         | emea-fr-pra-edge  |
| 東日本                             | apac-jp-kaw-edge  |
| 北ヨーロッパ                           | emea-gb-db3-azr   |
| 米国中北部                       | us-il-ch1-azr     |
| 米国中南部                       | us-tx-sn1-azr     |
| 東南アジア                         | apac-sg-sin-azr   |
| 英国西部                                | emea-se-sto-edge  |
| 西ヨーロッパ                            | emea-nl-ams-azr   |
| 米国西部                                | us-ca-sjc-azr     |
| 英国南部                               | emea-ru-msa-edge  |

## <a name="see-your-availability-test-results"></a>可用性テストの結果を表示する

可用性テストの結果は、折れ線グラフと散布図の両方で視覚化できます。

数分後に、 **[更新]** をクリックすると、テスト結果が表示されます。

:::image type="content" source="./media/monitor-web-app-availability/availability-refresh-002.png" alt-text="スクリーンショットには、[更新] ボタンが強調表示された [可用性] ページが示されています。":::

散布図には、診断テスト手順の詳細が含まれたテスト結果のサンプルが表示されます。 テスト エンジンは、失敗したテストの診断の詳細を格納します。 成功したテストの場合、診断の詳細は実行のサブセットに対して格納されます。 緑色/赤色の点の上にポインターを置くと、テスト、テスト名、および場所が表示されます。

:::image type="content" source="./media/monitor-web-app-availability/availability-scatter-plot-003.png" alt-text="行ビュー。" border="false":::

特定のテスト、場所を選択するか、または期間を短くすると、目的の期間に関するより詳細な結果が表示されます。 Search エクスプローラーを使用してすべての実行の結果を表示するか、または分析クエリを使用してこのデータに対してカスタム レポートを実行します。

## <a name="inspect-and-edit-tests"></a>テストを調べて編集する

テストの編集、一時的な無効化、または削除を行うには、テスト名の横の省略記号をクリックします。 変更を行った後、すべてのテスト エージェントに構成の変更が反映されるまで、最大 20 分かかる可能性があります。

:::image type="content" source="./media/monitor-web-app-availability/edit.png" alt-text="テスト詳細の表示、Web テストの編集および無効化。" border="false":::

サービスに対するメンテナンスを実行している間、関連付けられた可用性テストまたはアラート ルールを無効にすることもできます。

## <a name="if-you-see-failures"></a>エラーが発生した場合

赤い点を選択します。

:::image type="content" source="./media/monitor-web-app-availability/end-to-end.png" alt-text="[エンドツーエンドのトランザクションの詳細] タブのスクリーンショット。" border="false":::

可用性のテスト結果から、すべてのコンポーネントにわたるトランザクションの詳細を確認できます。 ここで、次のことを行うことができます。

* トラブルシューティング レポートを確認して、テストが失敗する原因を特定しますが、アプリケーションは引き続き利用できます。
* サーバーから受信した応答を調べる。
* 失敗した可用性テストの処理中に収集された、サーバー側の相関関係を持つテレメトリを使用してエラーを診断する。
* 懸案や作業の項目を Git または Azure Boards に記録して問題を追跡する。 バグには、このイベントへのリンクが含まれます。
* Visual Studio で Web テスト結果を開く。

エンドツーエンドのトランザクションの診断エクスペリエンスの詳細については、 [トランザクション診断のドキュメント](./transaction-diagnostics.md)を参照してください。

例外の行をクリックすると、代理可用性テストが失敗した原因であるサーバー側の例外の詳細が表示されます。 コード レベルの豊富な診断の [デバッグ スナップショット](./snapshot-debugger.md)を取得することもできます。

:::image type="content" source="./media/monitor-web-app-availability/open-instance-4.png" alt-text="サーバー側の診断。":::

生の結果に加えて、[メトリックス エクスプローラー](../essentials/metrics-getting-started.md)に 2 つの重要な可用性メトリックを表示することもできます。

1. 可用性:すべてのテスト実行にわたる、成功したテストの割合 (%)。
2. テスト期間:すべてのテスト実行にわたる平均のテスト期間。

## <a name="automation"></a>Automation

* [PowerShell スクリプトを使用して、可用性テストを自動的に設定します](./powershell.md#add-an-availability-test)。
* アラートが発生したときに呼び出される [webhook](../alerts/alerts-webhooks.md) を設定する。


## <a name="next-steps"></a>次のステップ

* [可用性のアラート](availability-alerts.md)
* [複数ステップ Web テスト](availability-multistep.md)
* [トラブルシューティング](troubleshoot-availability.md)
