---
title: ID モデル
titleSuffix: An Azure Communication Services concept
description: ID とアクセス トークンについて説明します
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 10/26/2020
ms.topic: conceptual
ms.service: azure-communication-services
ms.openlocfilehash: 996f138a14923319381738e7a55cd7ba4e8c4320
ms.sourcegitcommit: 5831eebdecaa68c3e006069b3a00f724bea0875a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2020
ms.locfileid: "94517769"
---
# <a name="identity-model"></a>ID モデル

Azure Communication Services は、ID に依存しないサービスです。 この設計には、次のような複数の利点があります。
- ID 管理システムの既存の ID を再利用
- 統合シナリオの柔軟性
- Azure Communication Services に対して ID を非公開

システム内の既存の情報を複製するのではなく、ビジネス ケースに固有のマッピング関係を保持します。 たとえば、ID の 1:1、1:N、N:1、N:M のマッピングなどです。 外部識別子 (電話番号、ユーザー、デバイス、アプリケーション、GUID など) を Azure Communication ID として使用することはできません。 Azure Communication Service ID 用に生成されたアクセス トークンは、チャットや通話などのプリミティブにアクセスするために使用されます。 

## <a name="identity"></a>ID

ID は、Azure Communication Service 管理ライブラリを使用して作成されます。 ID は会話の識別子として機能し、アクセス トークンの作成に使用されます。 同じ ID が、複数のデバイスにまたがる複数の同時セッションに参加する場合があります。 ID は、同時に複数のアクティブなアクセス トークンを持つ場合があります。 ID、リソース、またはサブスクリプションを削除すると、すべてのアクセス トークンが無効になり、この ID 用に格納されているすべてのデータが削除されます。 削除された ID は、新しいアクセス トークンを発行することも、以前に格納されたデータ (チャット メッセージ) にアクセスすることもできません。 

所有する ID の数ではなくプリミティブの使用によって課金されます。 ID の数によって、アプリケーションの ID を Azure Communication Services ID にマップする方法を制限する必要はありません。 マッピングの自由には、プライバシーの観点から責任が伴います。 アプリケーションのユーザーをシステムから削除する場合、そのユーザーに関連付けられたすべての ID を削除する必要があります。

Azure Communication Services によって、匿名ユーザーの特別な ID は提供されません。 ユーザーと ID 間のマッピングは保持されず、ID が匿名であるかどうかはわかりません。 要件に合わせて概念を設計できます。 各アプリケーションの匿名ユーザー用に新しい ID を作成することをお勧めします。 有効なアクセス トークンを所有していれば、だれでも、ID の削除されていないコンテンツにアクセスできます。 たとえば、ユーザーによって送信されたチャット メッセージなどです。 アクセスは、アクセス トークンに含まれるスコープのみに制限されます。 スコープの詳細については、セクション「"*アクセス トークン*"」を参照してください。

### <a name="mapping-of-identities"></a>ID のマッピング

Azure Communication Services によって IMS 機能はレプリケートされません。 顧客が顧客固有の ID を使用する方法は提供されません。 たとえば、電話番号またはメールアドレスなどです。 代わりに、アプリケーションの識別子に割り当てることができる一意識別子が提供されます。 Azure Communication Services によって、ユーザーの正体を明かす可能性のある情報が格納されることはありません。

複製する代わりに、ユーザーを ID ドメインから Azure Communication Service ID にマップする方法を設計することをお勧めします。 1:1、1:N、N:1 または M:N のいずれかのパターンに従うことができます。 単一のユーザーを単一の ID または複数の ID のどちらにマップするかを決定できます。 新しい ID を作成する場合、この ID と、アプリケーションの単一または複数のユーザーとのマッピングを保存することをお勧めします。 ID には、プリミティブを使用するためのアクセス トークンが必要であるため、アプリケーションの単一または複数のユーザーに ID を認識させる必要があります。

ユーザーの保存にリレーショナル データベースを使用している場合、実装はマッピング シナリオによって異なる可能性があります。 1:1 または N:1 のマッピングを使用するシナリオの場合、テーブルに *CommunicationServicesId* 列を追加して、Azure Communication Services ID を格納できます。 1:N または N:M のリレーションシップを使用するシナリオでは、リレーショナル データベースに個別のテーブルを作成することを検討してください。

## <a name="access-token"></a>アクセス トークン

アクセス トークンは、Azure Communication Service プリミティブへのアクセスを取得するために使用できる JWT トークンです。 発行されたアクセス トークンには、整合性の保護が含まれており、発行後にそのクレームを変更することはできません。 つまり、ID、有効期限、またはスコープなどのプロパティを手動で変更すると、アクセス トークンは無効になります。 無効のトークンでプリミティブを使用すると、プリミティブへのアクセスが拒否されます。 

アクセス トークンのプロパティは、*identity、expiration*、*scopes* です。 アクセス トークンは、24 時間常時有効です。 この時間が経過すると、アクセス トークンは無効になり、プリミティブへのアクセスに使用できなくなります。 ID には、サーバー側のサービスに対して新しいアクセス トークンを要求する方法が必要です。 パラメーター *scope* を使用して、空ではない使用可能なプリミティブ セットを定義します。 Azure Communication Services により、アクセス トークンに対して次のスコープがサポートされます。

|名前|説明|
|---|---|
|チャット|  チャットに参加する機能を許可します|
|VoIP|  ID と電話番号を呼び出す機能を許可します|


有効期限が切れる前にアクセス トークンを取り消す必要がある場合、Azure Communication Service 管理ライブラリを使用できます。 トークンの失効は即時的ではなく、伝達するために最長で 15 分かかります。 ID、リソース、またはサブスクリプションを削除すると、すべてのアクセス トークンが失効します。 特定の機能にアクセスするユーザーの機能を削除する必要がある場合、すべてのアクセス トークンを取り消します。 次に、スコープ セットをさらに制限して、新しいアクセス トークンを発行します。
Azure Communication Service のアクセス キーをローテーションさせると、以前のアクセス キーを使用して作成されたアクティブなアクセス トークンはすべて取り消されます。 すべての ID は、Azure Communication Service にアクセスできなくなり、新しいアクセス トークンを発行することが必要になります。 

クライアントのアプリケーションではなくサーバー側のサービスでアクセス トークンを発行することをお勧めします。 これは、発行にはアクセス キーまたは管理された ID が必要であるためです。 セキュリティ上の理由から、クライアントのアプリケーションとアクセス キーを共有することはお勧めしません。 クライアント アプリケーションでは、クライアントを認証でき、クライアントに代わってアクセス トークンを発行できる信頼されたサービス エンドポイントを使用する必要があります。 アーキテクチャの詳細については、[こちら](./client-and-server-architecture.md)を参照してください。

アクセス トークンをバッキング ストアにキャッシュする場合、暗号化を使用することをお勧めします。 アクセス トークンは機密データであり、保護されていない場合は悪意のあるアクティビティに利用される危険性があります。 アクセス トークンを所有している場合、SDK を初期化し、API にアクセスできます。 アクセス可能な API は、アクセス トークンが持つスコープに基づいてのみ制限されます。 必要なスコープのみを使用してアクセス トークンを発行することをお勧めします。

## <a name="next-steps"></a>次のステップ

* アクセス トークンの管理の概要については、「[アクセス トークンを作成して管理する](https://docs.microsoft.com/azure/communication-services/quickstarts/access-tokens)」を参照してください
* 認証の概要については、「[Azure Communication Services に対する認証](https://docs.microsoft.com/azure/communication-services/concepts/authentication)」を参照してください
* データ所在地とプライバシーの概要については、「[利用可能なリージョンとデータの保存場所](https://docs.microsoft.com/azure/communication-services/concepts/privacy)」を参照してください