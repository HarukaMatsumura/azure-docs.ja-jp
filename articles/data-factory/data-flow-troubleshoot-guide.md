---
title: マッピング データ フローのトラブルシューティング
description: Azure Data Factory でのデータ フローに関する問題のトラブルシューティングを行う方法について説明します。
ms.author: makromer
author: kromerm
ms.reviewer: daperlov
ms.service: data-factory
ms.subservice: data-flows
ms.topic: troubleshooting
ms.date: 10/01/2021
ms.openlocfilehash: f41d53207eb00e4044e523e481de444a615a5d88
ms.sourcegitcommit: 7bd48cdf50509174714ecb69848a222314e06ef6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/02/2021
ms.locfileid: "129389401"
---
# <a name="troubleshoot-mapping-data-flows-in-azure-data-factory"></a>Azure Data Factory でマッピング データ フローをトラブルシューティングする

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

この記事では、Azure Data Factory でマッピング データ フローのための一般的なトラブルシューティング方法について説明します。  特定のエラー メッセージ、および関連する原因と推奨事項については、[一般的なデータ フローのエラー コードとメッセージ](data-flow-troubleshoot-errors.md)に関するページを参照してください。

## <a name="miscellaneous-troubleshooting-tips"></a>その他のトラブルシューティングのヒント
- **問題**: 予期しない例外が発生し、実行が失敗しました。
    - **メッセージ**:データ フロー アクティビティの実行中:予期しない例外が発生し、実行が失敗しました。
    - **原因**: このエラーはバックエンド サービス エラーです。 操作を再試行し、デバッグ セッションを再起動してみてください。
    - **推奨事項**: 再試行して再起動しても問題が解決しない場合は、カスタマー サポートにお問い合わせください。

-  **問題**: デバッグ データ プレビューの間の結合で出力データがありません。
    - **メッセージ**:サンプリングされた行数が少なすぎることが原因で発生した可能性がある、多数の null 値または不足値があります。 デバッグ行の制限を更新し、データを最新の情報に更新してみてください。
    - **原因**: データ プレビューの間に、結合条件が、どの行とも一致しなかったか、多数の null 値になりました。
    - **推奨事項**: **[Debug Settings]\(デバッグ設定\)** で、ソース行の制限の行数を増やします。 より多くのデータを処理するのに十分な大きさのデータ フロー クラスターを持つ Azure IR を選択してください。
    
- **問題**: 複数行の CSV ファイルが含まれるソースで検証エラーが発生しました。 
    - **メッセージ**: 次のエラー メッセージのいずれかが表示される場合があります。
        - 最後の列が null であるか、見つかりません。
        - ソースでスキーマの検証に失敗しました。
        - UX でスキーマのインポートが正しく表示されず、最後の列の名前に改行文字が含まれています。
    - **原因**: 現在、マッピング データ フローでは、行区切り記号として \r\n が使用されている場合、複数行の CSV ソース ファイルは機能しません。 復帰に余分な行があると、エラーが発生することがあります。 
    - **推奨事項**:行区切り記号として \r\n ではなく \n が使用されているソースで、ファイルを生成します。 または、コピー アクティビティを使用して、行区切り記号として \n を使用するように CSV ファイルを変換します。

## <a name="general-troubleshooting-guidance"></a>一般的なトラブルシューティング ガイダンス
1. データセット接続の状態を確認します。 ソースとシンクの変換ごとに、使用している各データベースのリンク サービスに移動して、接続をテストします。
2. データ フロー デザイナーでファイルとテーブルの接続の状態をご確認ください。 デバッグ モードで、ソース変換の **[Data Preview]\(データ プレビュー\)** を選択し、確実にデータにアクセスできるようにします。
3. データ プレビューですべてが正しいようであれば、パイプライン デザイナーに進み、パイプライン アクティビティにデータ フローを配置します。 エンドツーエンド テストとしてパイプラインをデバッグします。

### <a name="improvement-on-csvcdm-format-in-data-flow"></a>データ フローでの CSV/CDM 形式の改善 

**Azure Data Factory V2 での マッピング データ フローに区切りテキストまたは CDM の書式設定** を使用した場合、**2021 年 5 月 1 日** 以降、データ フローの区切りテキスト/CDM が改善されているため、既存のパイプラインに動作変更が発生する可能性があります。 

改善前は次の問題が発生する可能性がありますが、改善後は問題が修正されました。 この改善によって影響を受けるかどうかを判断するには、次のコンテンツをお読みください。 

#### <a name="scenario-1-encounter-the-unexpected-row-delimiter-issue"></a>シナリオ 1: 行区切り記号の予期しない問題が発生する

 次の条件に該当する場合は、影響を受けます。
 - 複数行の設定をソースとして True または CDM に設定して、区切りテキストを使用する。
 - 最初の行の文字数が 128 文字を超えている。 
 - データ ファイル内の行区切り記号が `\n` ではない。

 改善前は、区切りテキスト ファイルの解析に既定の行区切り記号 `\n` が予期せず使用される場合があります。これは、複数行の設定が True に設定されている場合に、行区切り記号の設定が無効になり、最初の 128 文字に基づいて行区切り記号が自動的に検出されるためです。 実際の行区切り記号が検出されなかった場合は、`\n` にフォールバックします。  

 改善後は、3 つの行区切り記号 (`\r`、`\n`、`\r\n`) のいずれも機能します。
 
 次の例は、改善後の 1 つのパイプラインの動作変更を示しています。

 **例**:<br/>
   次の列の場合:<br/>
    `C1, C2, {long first row}, C128\r\n `<br/>
    `V1, V2, {values………………….}, V128\r\n `<br/>
 
   改善前、`\r` は列の値に保持されます。 解析された列の結果は次のようになります。<br/>
   `C1 C2 {long first row} C128`**`\r`**<br/>
   `V1 V2 {values………………….} V128`**`\r`**<br/> 

   改善後、解析された列の結果は次のようになります。<br/>
   `C1 C2 {long first row} C128`<br/>
   `V1 V2 {values………………….} V128`<br/>
  
#### <a name="scenario-2-encounter-an-issue-of-incorrectly-reading-column-values-containing-rn"></a>シナリオ 2: '\r\n' を含む列の値を誤って読み取る問題が発生する

 次の条件に該当する場合は、影響を受けます。
 - 複数行の設定をソースとして True または CDM に設定して、区切りテキストを使用する。 
 - 行区切り記号が `\r\n` である。

 改善前、列の値を読み取るときに、その値の `\r\n` が誤って `\n` に置き換えられる場合があります。 

 改善後、列の値の `\r\n` は `\n` に置き換えられません。

 次の例は、改善後の 1 つのパイプラインの動作変更を示しています。
 
 **例**:<br/>
  
 次の列の場合:<br/>
  **`"A\r\n"`**`, B, C\r\n`<br/>

 改善前、解析された列の結果は次のようになります。<br/>
  **`A\n`**` B C`<br/>

 改善後、解析された列の結果は次のようになります。<br/>
  **`A\r\n`**` B C`<br/>  

#### <a name="scenario-3-encounter-an-issue-of-incorrectly-writing-column-values-containing-n"></a>シナリオ 3: '\n' を含む列の値を誤って書き込む問題が発生する

 次の条件に該当する場合は、影響を受けます。
 - 区切りテキストをシンクとして使用する。
 - 列の値に `\n` が含まれている。
 - [行区切り記号] を `\r\n` に設定します。
 
 改善前、列の値を書き込むときに、その値の `\n` が誤って `\r\n` に置き換えられる場合があります。 

 改善後、列の値の `\n` は `\r\n` に置き換えられません。
 
 次の例は、改善後の 1 つのパイプラインの動作変更を示しています。

 **例**:<br/>

 次の列の場合:<br/>
 **`A\n`**` B C`<br/>

 改善前、CSV シンクは次のようになります。<br/>
  **`"A\r\n"`**`, B, C\r\n` <br/>

 改善後、CSV シンクは次のようになります。<br/>
  **`"A\n"`**`, B, C\r\n`<br/>

#### <a name="scenario-4-encounter-an-issue-of-incorrectly-reading-empty-string-as-null"></a>シナリオ 4: 空の文字列を NULL として誤って読み取る問題が発生する
 
 次の条件に該当する場合は、影響を受けます。
 - 区切りテキストをソースとして使用する。 
 - NULL 値が空でない値に設定される。 
 - 列の値が空の文字列で、引用符で囲まれていない。 
 
 改善前、引用符で囲まれていない空の文字列の列の値は NULL として読み取られます。 

 改善後、空の文字列は NULL 値として解析されません。 
 
 次の例は、改善後の 1 つのパイプラインの動作変更を示しています。

 **例**:<br/>

 次の列の場合:<br/>
  `A, ,B, `<br/>

 改善前、解析された列の結果は次のようになります。<br/>
  `A null B null`<br/>

 改善後、解析された列の結果は次のようになります。<br/>
  `A "" (empty string) B "" (empty string)`<br/>

###  <a name="internal-server-errors"></a>内部サーバー エラー

内部サーバー エラーの原因となる可能性がある特定のシナリオを次に示します。

#### <a name="scenario-1-not-choosing-the-appropriate-compute-sizetype-and-other-factors"></a>シナリオ 1: コンピューティングの適切なサイズや種類、その他の要因が選択されていない

  データ フローの正常な実行は、コンピューティングのサイズと種類、処理するソースとシンクの数、パーティションの指定、関連する変換、データセットのサイズ、データの偏りなど、さまざまな要因に依存します。<br/>
  
  詳細なガイドについては、[Integration Runtime のパフォーマンス](concepts-integration-runtime-performance.md)に関するページを参照してください。

#### <a name="scenario-2-using-debug-sessions-with-parallel-activities"></a>シナリオ 2: 並列アクティビティでのデバッグ セッションの使用

  パイプラインに ForEach のようなコンストラクトが含まれるデータ フロー デバッグ セッションを使用して実行をトリガーすると、同じクラスターに複数の並列実行が送信される可能性があります。 この状況では、メモリ不足などのリソースの問題のため、クラスターの障害に関する問題が実行中に発生する可能性があります。<br/>
  
  変更を発行した後に、パイプライン アクティビティで定義されている適切な統合ランタイム構成を使用して実行を送信するには、 **[今すぐトリガー]** または **[デバッグ]**  >  **[アクティビティ ランタイムを使用]** を選択します。

#### <a name="scenario-3-transient-issues"></a>シナリオ 3: 一時的な問題

  実行に関係するマイクロサービスの一時的な問題により、実行が失敗する可能性があります。<br/>
  
  パイプライン アクティビティに再試行を構成すると、一時的な問題による問題が解決されることがあります。 詳細なガイドについては、「[アクティビティ ポリシー](concepts-pipelines-activities.md#activity-json)」を参照してください。

## <a name="next-steps"></a>次のステップ

トラブルシューティングの詳細について、次のリソースを参照してください。

- [一般的なマッピング データ フローのエラーとメッセージ](data-flow-troubleshoot-errors.md)
- [Data Factory ブログ](https://azure.microsoft.com/blog/tag/azure-data-factory/)
- [Data Factory の機能のリクエスト](/answers/topics/azure-data-factory.html)
- [Azure のビデオ](https://azure.microsoft.com/resources/videos/index/?sort=newest&services=data-factory)
- [Data Factory の Stack Overflow フォーラム](https://stackoverflow.com/questions/tagged/azure-data-factory)
- [Data Factory に関する Twitter 情報](https://twitter.com/hashtag/DataFactory)
