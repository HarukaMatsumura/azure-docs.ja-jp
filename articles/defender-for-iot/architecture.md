---
title: Azure Defender for IoT のアーキテクチャ
description: Azure Defender for IoT のアーキテクチャと情報フローについて説明します。
services: defender-for-iot
ms.service: defender-for-iot
documentationcenter: na
author: rkarlin
manager: rkarlin
editor: ''
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 10/08/2020
ms.author: rkarlin
ms.openlocfilehash: a8697094a3366e3b82ca65f1b962101243b22f84
ms.sourcegitcommit: 65db02799b1f685e7eaa7e0ecf38f03866c33ad1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/03/2020
ms.locfileid: "96548921"
---
# <a name="azure-defender-for-iot-architecture"></a>Azure Defender for IoT のアーキテクチャ

この記事では、Defender for IoT ソリューションの機能的なシステム アーキテクチャについて説明します。

## <a name="defender-for-iot-components"></a>Defender for IoT のコンポーネント

Defender for IoT は、Azure クラウドとオンプレミスのコンポーネントの両方に接続します。 このソリューションは、複数のリモートの場所を持つ大規模で地理的に分散した環境でのスケーラビリティを考慮して設計されています。 このソリューションを使用すると、国、地域、事業単位、またはゾーンごとの多層分散アーキテクチャを実現できます。 

Azure Defender for IoT には、次のコンポーネントが含まれています。 

**クラウドに接続されたデプロイ**

- Azure Defender for IoT センサー VM またはアプライアンス
- クラウド管理と Azure Sentinel への統合のための Azure portal
- ローカル サイト管理のためのオンプレミスの管理コンソール
- 埋め込みセキュリティ エージェント (オプション)

**エアギャップ (オフライン) デプロイ**

- Azure Defender for IoT センサー VM またはアプライアンス
- ローカル サイト管理のためのオンプレミスの管理コンソール


![Defender for IoT のアーキテクチャ](./media/architecture/defender-iot-security-architecture.png)

### <a name="azure-defender-for-iot-sensors"></a>Azure Defender for IoT センサー

Defender for IoT センサーは、ネットワーク デバイスを検出し、継続的に監視します。 センサーは、IoT および OT デバイスのパッシブ (エージェントレス) 監視を使用して、ICS ネットワーク トラフィックを収集します。 
 
IoT および OT ネットワーク用に特別に構築されたエージェントレス テクノロジは、ネットワークに接続されてから数分以内に IoT と OT のリスクを詳細に可視化します。 非干渉型のネットワーク トラフィック分析 (NTA) アプローチにより、ネットワークとネットワーク デバイスのパフォーマンスへの影響はゼロになります。 
 
特許取得済みの、IoT および OT に対応した行動分析とレイヤー 7 のディープ パケット インスペクション (DPI) を活用することで、従来の署名ベースのソリューションを超えて分析し、異常または無許可のアクティビティに基づいて、高度な IoT と OT の脅威 (ファイルレス マルウェアなど) を即座に検出することができます。 
  
Defender for IoT センサーは、SPAN ポートまたはネットワーク TAP に接続し、IoT と OT ネットワーク トラフィックでの DPI の実行を直ちに開始します。 
 
データの収集、処理、分析、およびアラートは、センサー上で直接実行されます。 メタデータのみが管理コンソールに転送されるため、これは、帯域幅が低いか待機時間の長い接続を使用する場所に最適です。

センサーには 5 つの分析検出エンジンが含まれています。 このエンジンは、リアルタイムおよび事前記録されたトラフィックの両方の分析に基づいてアラートをトリガーします。 次のエンジンを使用できます。 

#### <a name="protocol-violation-detection-engine"></a>プロトコル違反検出エンジン
プロトコル違反検出エンジンは、次のように、ICS プロトコル仕様に違反するパケット構造とフィールド値の使用を識別します。Modbus の例外、廃止された関数コードのアラートの開始。

#### <a name="policy-violation-detection-engine"></a>ポリシー違反検出エンジン
機械学習を使用して、ポリシー違反検出エンジンは、特定の関数コードの無許可の使用、特定のオブジェクトへのアクセス、デバイス構成の変更など、ベースライン動作からの逸脱をユーザーに警告します。 次に例を示します。DeltaV ソフトウェア バージョンが変更され、無許可の PLC プログラミング アラートが生成されます。 具体的には、ポリシー違反エンジンは、産業有限状態モデリング (IFSM) と呼ばれる特許取得済みの手法を使用して、ICS ネットワークを状態と遷移の決定論的シーケンスとしてモデル化します。 ポリシー違反検出エンジンは、ICS ネットワークのベースラインを確立します。これにより、プラットフォームでは、(もともと OT ネットワークではなく IT 用に開発された) 一般的な数学的アプローチまたは分析よりもネットワークのベースラインを構築するために必要な学習期間が短くなります。

#### <a name="industrial-malware-detection-engine"></a>産業用マルウェア検出エンジン
産業用マルウェア検出エンジンは、Conficker、Black Energy、Havex、WannaCry、NotPetya、Triton などの既知のマルウェアが存在することを示す動作を識別します。 

#### <a name="anomaly-detection-engine"></a>異常検出エンジン
異常検出エンジンは、通常とは異なるマシン間 (M2M) 通信と動作を検出します。 ICS ネットワークを状態と遷移の決定論的シーケンスとしてモデル化することにより、プラットフォームでは、(もともと OT ではなく IT 用に開発された) 一般的な数学的アプローチまたは分析よりも必要な学習期間が短くなります。 また、擬陽性を最小限に抑えながら、異常を迅速に検出します。 異常検出エンジンのアラートには、過剰な SMB サインイン試行と、PLC スキャン検出アラートが含まれます。

#### <a name="operational-incident-detection"></a>操作上のインシデント検出
操作上のインシデント検出では、機器障害の初期兆候を示す可能性がある、断続的な接続などの操作上の問題が検出されます。 たとえば、デバイスの切断 (無応答) が疑われ、Siemens S7 stop PLC コマンドがアラートを送信される場合があります。


### <a name="management-consoles"></a>管理コンソール
ハイブリッド環境全体での Azure Defender for IoT の管理は、次の 2 つの管理ポータルを使用して行います。 
- センサー コンソール
- オンプレミスの管理コンソール
- Azure ポータル

#### <a name="sensor-console"></a>センサー コンソール
センサー検出はセンサー コンソールに表示され、それらをネットワーク マップ、資産インベントリ、およびさまざまなレポート (リスク評価レポート、データ マイニング クエリ、攻撃ベクトルなど) で表示、調査、分析することができます。 また、コンソールを使用して、センサー エンジンによって検出された脅威を表示および処理したり、情報をサードパーティ システムに転送したり、ユーザーを管理したりすることもできます。

![Defender for IoT のセンサー コンソール](./media/architecture/sensor-console.png)

#### <a name="on-premises-management-console"></a>オンプレミスの管理コンソール
オンプレミスの管理コンソールを使用すると、セキュリティ オペレーション センター (SOC) のオペレーターは、複数のセンサーから 1 つのダッシュボードに集約されたアラートを管理および分析し、OT ネットワークの正常性を全体的に把握できます。

このアーキテクチャは、SOC レベルでのネットワークの包括的な統合ビュー、最適化されたアラート処理、操作上のネットワーク セキュリティの制御を提供します。これにより、意思決定とリスク管理を円滑に行うことができます。

管理コンソールは、マルチテナント、監視、データ分析、および集中型センサー リモート コントロールに加えて、追加のシステム メンテナンス ツール (アラートの除外など) と、各リモート アプライアンスの完全にカスタマイズされたレポート機能を提供します。 このスケーラブルなアーキテクチャは、サイト レベル、ゾーン レベルでのローカル管理と、SOC 内でのグローバル管理の両方をサポートします。

管理コンソールは、回復に必要なすべての構成ファイルのバックアップを定期的に受信するバックアップ コンソールを提供する高可用性構成のためにデプロイできます。 マスター コンソールで障害が発生した場合、ローカル サイトの管理アプライアンスは自動的にフェールオーバーしてバックアップ コンソールと同期し、中断することなく可用性を維持します。

#### <a name="azure-portal"></a>Azure portal

Azure の Defender for IoT ポータルを使用して、次のようなことができます。ソリューション アプライアンスの購入、ソフトウェアのインストールと更新、Azure へのセンサーのオンボード、脅威インテリジェンス パッケージの更新

## <a name="embedded-security-agent-built-in-mode"></a>埋め込まれたセキュリティ エージェント: 組み込みモード

**組み込み** モードでは、IoT Hub で **[セキュリティ]** オプションをオンにすると、Defender for IoT が有効になります。 リアルタイム監視、推奨事項の提示、アラート機能を備えた組み込みモードでは、デバイスの可視性と比類ないセキュリティが手軽に得られます。 組み込みモードでは、デバイスにエージェントをインストールする必要がありません。ログに記録されたアクティビティに対する高度な分析を使用してフィールド デバイスおよび IoT ハブが分析され、保護されます。

## <a name="embedded-security-agent-enhanced-mode"></a>埋め込まれたセキュリティ エージェント: 拡張モード

**拡張** モードでは、IoT Hub で **[セキュリティ]** オプションをオンにし、デバイスに Defender for IoT デバイス エージェントをインストールすると、エージェントによってそのデバイスから生のセキュリティ イベントが収集、集計、分析されます。 未加工のセキュリティ イベントには、IP 接続、プロセス作成、ユーザー ログイン、およびその他のセキュリティ関連情報が含まれる可能性があります。 また、Defender for IoT デバイス エージェントではイベント集計も処理され、高いネットワーク スループットを回避できます。 エージェントは高度にカスタマイズ可能です。これにより、最速の SLA で重要な情報のみを送信するなど、特定のタスクを実行したり、広範なセキュリティ情報とコンテキストをより大きなセグメントに集計して、高いサービス コストを回避したりできます。

デバイス エージェント、およびその他のアプリケーションでは、**Azure セキュリティ メッセージの送信 SDK** を使用して、Azure IoT Hub にセキュリティ情報が送信されます。 IoT Hub ではこの情報が取得され、Defender for IoT サービスに転送されます。

Defender for IoT サービスが有効になると、IoT Hub により、転送されたデータに加え、そのすべての内部データが Defender for IoT での分析用に送信されます。 このデータには、デバイス クラウド操作ログ、デバイス ID、および Hub 構成が含まれます。 この情報はすべて、Defender for IoT 分析パイプラインを作成するのに役立ちます。

また、Defender for IoT 分析パイプラインにより、Microsoft および Microsoft パートナー内のさまざまなソースから、その他の脅威インテリジェンス ストリームが受信されます。 Defender for IoT の分析パイプライン全体が、サービスに対して行われたすべての顧客構成 (カスタム アラートや、セキュリティ メッセージの送信 SDK の使用など) と連携します。

Defender for IoT により、分析パイプラインを使用して、実用的な推奨事項およびアラートを生成するためにすべての情報ストリームが結合されます。 パイプラインには、セキュリティ研究者と専門家によって作成されたカスタム ルールと、標準的なデバイスの動作とリスクの分析からの偏差を検索する機械学習モデルの両方が含まれています。

Defender for IoT の推奨事項とアラート (分析パイプライン出力) は、各顧客の Log Analytics ワークスペースに書き込まれます。 ワークスペースおよび未加工のイベントにアラートと推奨事項を含めると、検出された不審なアクティビティの正確な情報を使用して詳細な調査とクエリを行うことができます。

## <a name="next-steps"></a>次のステップ

この記事では、Defender for IoT ソリューションの基本的なアーキテクチャとワークフローについて説明しました。 IoT Hub でセキュリティ ソリューションの使用を開始し、有効化するための前提条件と方法の詳細については、次の記事を参照してください。

- [サービスの前提条件](service-prerequisites.md)
- [作業の開始](getting-started.md)
- [ソリューションを構成する](quickstart-configure-your-solution.md)
- [IoT Hub でセキュリティを有効化する](quickstart-onboard-iot-hub.md)
- [Defender for IoT に関する FAQ](resources-frequently-asked-questions.md)
- [Defender for IoT のセキュリティ アラート](concept-security-alerts.md)
