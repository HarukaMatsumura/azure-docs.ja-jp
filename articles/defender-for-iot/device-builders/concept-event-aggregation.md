---
title: マイクロ エージェントのイベント コレクション (プレビュー)
description: Defender for IoT セキュリティ エージェントにより、ローカル デバイスからデータとシステム イベントを収集し、処理と分析を行うためにこのデータを Azure クラウドに送信します。
ms.date: 07/15/2021
ms.topic: conceptual
ms.openlocfilehash: 6836c12f625645c5b9e0913f9d2f3f36fc06843e
ms.sourcegitcommit: ddac53ddc870643585f4a1f6dc24e13db25a6ed6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/18/2021
ms.locfileid: "122397501"
---
# <a name="micro-agent-event-collection-preview"></a>マイクロ エージェントのイベント コレクション (プレビュー)

Defender for IoT セキュリティ エージェントにより、ローカル デバイスからデータとシステム イベントを収集し、処理と分析を行うためにこのデータを Azure クラウドに送信します。 Defender for IoT マクロ エージェントは、新しいプロセスなどのさまざまな種類のデバイス イベントとすべての新しい接続イベントを収集します。 新しいプロセスと新しい接続イベントの両方がデバイス上で 1 秒以内に頻繁に発生する可能性があります。 この機能は、包括的なセキュリティを実現するために重要ですが、セキュリティ エージェントが送信するメッセージの数は、IoT Hub のクォータとコストの上限に短期間で達するか、それを超える可能性があります。 いずれにせよ、これらのイベントには、デバイスの保護に不可欠な重要なセキュリティ情報が含まれています。 

デバイスを保護しながら、追加のクォータとコストを削減するため、Defender for IoT エージェントによりこれらの種類のイベントが集計されます。 

- ProcessCreate (Linux のみ) 

- Network ConnectionCreate

- システム情報

- ベースライン

イベント ベースのコレクターは、デバイス内からの対応するアクティビティに基づいてトリガーされるコレクターです。 たとえば、デバイスでプロセスが開始されたとします。  

トリガー ベースのコレクターは、顧客の構成に応じて、スケジュールに従ってトリガーされるコレクターです。

## <a name="how-does-event-aggregation-work"></a>イベント集計のしくみ 

Defender for IoT エージェントにより、間隔の期間または時間枠についてイベントが集計されます。 間隔の期間が経過すると、エージェントは、詳細な分析のために、集計されたイベントを Azure クラウドに送信します。 集計されたイベントは、Azure クラウドに送信されるまでメモリに格納されます。 

エージェントにより、既にメモリに格納されているものと同じイベントが収集されます。 この収集により、エージェントでこの特定のイベントのヒット カウントが増加し、エージェントのメモリ フットプリントが削減されます。 集計の時間枠が経過すると、エージェントは、発生したそれぞれの種類のイベントのヒット カウントを送信します。 イベント集計は、単に、収集された各種類のイベントのヒット カウントの集計です。 

## <a name="process-events-event-based"></a>プロセス イベント (イベント ベース)

プロセス イベントは Linux オペレーティング システムでサポートされています。 

プロセス イベントは、*コマンド ライン* と  *userid* が同一である場合は同一であると見なされます。 

プロセス イベントの既定のバッファーは 256 プロセスです。 この制限に達すると、バッファーが循環し、最も古いイベントが破棄されて、最も新しく処理されたイベントのための領域が確保されます。 キャッシュ サイズを増やす際の警告がログに記録されます。

### <a name="data-collection"></a>データ コレクション

各イベントで収集されるデータ。

- **Timestamp** - プロセスが最初に観察された時刻。

- **Process_id** - Linux PID。

- **Parent_process_id** - Linux 親 PID (存在する場合)。

- **Commandline** - コマンド ライン。 

- **Type** - `fork` または `exec` のいずれか。

- **hit_count** - 集計カウント。 同じ概算時間中の、イベントがクラウドに送信されるまでの、同じプロセスの実行数。 

## <a name="network-connection-events-event-based-collector"></a>ネットワーク接続イベント (イベント ベースのコレクター)

ネットワーク接続イベントは、ローカル ポート、リモート ポート、トランスポート プロトコル、ローカル アドレス、およびリモート アドレスが同一である場合に同一と見なされます。

ネットワーク接続イベントの既定のバッファーは 256 です。 キャッシュがいっぱいの場合、次のようになります。 

- **Azure RTOS デバイス**: 新しいネットワーク イベントは、次の収集サイクルまでキャッシュされません。  

- **Linux デバイス**: 新しいイベントごとに、最も古いイベントが置き換えられます。 キャッシュ サイズを増やす際の警告がログに記録されます。

Linux デバイスでは、IPv4 のみがサポートされます。

### <a name="data-collection"></a>データ コレクション

各イベントで収集されるデータ。

- **Local address** – 接続のソース アドレス。

- **Remote address** – 接続の宛先アドレス。

- **Local port** - 接続のソース ポート。

- **Remote port** - 接続の宛先ポート。

- **Bytes_in** – 接続の集計済み RX バイトの合計。

- **Bytes_out** – 接続の集計済み TX バイトの合計。

- **Transport_protocol** – TCP、UDP、または ICMP のいずれか。

- **Application protocol** – 接続に関連付けられたアプリケーション プロトコル。

- **Extended properties** – 接続の追加の詳細。 たとえば、「 `host name` 」のように入力します。 

## <a name="baseline-trigger-based"></a>ベースライン (トリガー ベース) 

ベースライン コレクターでは、CIS チェックを定期的に実行します。 失敗した結果のみがクラウドに送信されます。 クラウドにより結果が集計され、推奨事項が提供されます。 

### <a name="data-collection"></a>データ コレクション

各イベントで収集されるデータ。

- **Check ID** – CIS 形式では CIS-debian-9-Filesystem-1.1.2。

- **Check result** - `Error` または `Fail` のいずれか。 たとえば、チェックを実行できない状況では `Error` です。

- **Error** - エラーの情報と説明。

- **Description** – CIS からのチェックの説明。

- **Remediation** – CIS からの修復のための推奨事項。

## <a name="next-steps"></a>次のステップ

[Defender for IoT のセキュリティ アラート](concept-security-alerts.md)について確認します。
