---
title: オンプレミスの管理コンソールを管理する
description: バックアップと復元、ホスト名の定義、センサーへのプロキシの設定など、オンプレミスの管理コンソールのオプションについて説明します。
author: shhazam-ms
manager: rkarlin
ms.author: shhazam
ms.date: 12/12/2020
ms.topic: article
ms.service: azure
ms.openlocfilehash: 34efef4a01b58cc26fd1567336184837a703ade2
ms.sourcegitcommit: 8be279f92d5c07a37adfe766dc40648c673d8aa8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/31/2020
ms.locfileid: "97836647"
---
# <a name="manage-the-on-premises-management-console"></a>オンプレミスの管理コンソールを管理する

この記事では、バックアップと復元、コミット済みデバイスのアクティブ化ファイルのダウンロード、証明書の更新、センサーへのプロキシの設定など、オンプレミスの管理コンソールのオプションについて説明します。

Azure portal からオンプレミスの管理コンソールをオンボードします。

## <a name="upload-an-activation-file"></a>アクティブ化ファイルをアップロードする

初めてサインインすると、オンプレミスの管理コンソールのアクティブ化ファイルがダウンロードされます。 このファイルには、オンボード プロセス中に定義された、コミット済みのデバイスの集合が含まれます。 この一覧には、複数のサブスクリプションに関連付けられているセンサーが含まれます。

最初にアクティブ化した後に、監視するデバイスの数が、オンボード中に定義されたコミット済みのデバイスの数を超えることがあります。 このイベントは、たとえば、管理コンソールにより多くのセンサーを接続した場合に発生する可能性があります。 監視するデバイスの数とコミット済みデバイスの数が一致しない場合は、管理コンソールに警告が表示されます。 このイベントが発生した場合は、新しいアクティブ化ファイルをアップロードする必要があります。

アクティブ化ファイルをアップロードするには:

1. Azure Defender for IoT の **[価格]** ページに移動します。
1. **[管理コンソールのアクティブ化ファイルのダウンロード]** タブを選択します。アクティブ化ファイルがダウンロードされます。

   :::image type="content" source="media/how-to-manage-sensors-from-the-on-premises-management-console/cloud_download_opm_activation_file.png" alt-text="アクティブ化ファイルをダウンロードします。":::

1. 管理コンソールで **[システム設定]** を選択します。
1. **[アクティブ化]** を選択します。
1. **[ファイルの選択]** を選択し、保存したファイルを選択します。

## <a name="manage-certificates"></a>証明書の管理

オンプレミスの管理コンソールのインストール後に、ローカルの自己署名証明書が生成され、管理コンソールの Web アプリケーションにアクセスするために使用されます。 管理者ユーザーが管理コンソールに初めてサインインすると、SSL/TLS 証明書を指定するように求められます。 初回セットアップの詳細については、「[オンプレミス管理コンソールをアクティブにしてセットアップする](how-to-activate-and-set-up-your-on-premises-management-console.md)」を参照してください。

次のセクションでは、証明書の更新、証明書の CLI コマンドの使用、サポートされている証明書と証明書のパラメーターについて説明します。

### <a name="about-certificates"></a>証明書について

Azure Defender for IoT は、SSL と TLS 証明書を使用して次のことを行います。

- CA 署名証明書をアップロードして、組織によって要求された特定の証明書と暗号化の要件を満たす。

- 管理コンソールと接続されたセンサーの間、および管理コンソールと高可用性管理コンソールの間の検証を行えるようにする。 検証は、証明書失効リストと証明書の有効期限に対して評価されます。 *検証が失敗した場合は、管理コンソールとセンサー間の通信が停止し、検証エラーがコンソールに表示されます。* このオプションは、インストール後に既定で有効になります。

サードパーティの転送ルールは検証されません。 たとえば、SYSLOG、Splunk、ServiceNow に送信されるアラート情報、Active Directory との通信などです。

### <a name="update-certificates"></a>証明書を更新する

オンプレミスの管理コンソールの管理者ユーザーは、証明書を更新できます。

証明書を更新するには:  

1. **[システム設定]** を選択します。
1. **[SSL/TLS Certificates]\(SSL/TLS 証明書\)** を選択します。
1. 証明書を削除または編集し、新しいものを追加します。
   
   - 証明書名を追加します。
   - CRT ファイルとキー ファイルをアップロードし、パスフレーズを入力します。
   - 必要に応じて PEM ファイルをアップロードします。

検証設定を変更するには:

1. **[Enable Certificate Validation]\(証明書の検証を有効にする\)** トグルをオンまたはオフにします。
1. **[保存]** を選択します。

オプションが有効になり、検証が失敗した場合は、管理コンソールとセンサー間の通信が停止し、検証エラーがコンソールに表示されます。

### <a name="certificate-support"></a>証明書のサポート

次の証明書がサポートされています。

- プライベートおよびエンタープライズ キー インフラストラクチャ (プライベート PKI) 
- 公開キー基盤 (パブリック PKI) 
- アプライアンスのローカルで生成された (ローカルで自己署名された) もの 

  > [!IMPORTANT]
  > 自己署名証明書の使用はお勧めしません。 この接続はセキュリティで保護されていないため、テスト環境でのみ使用してください。 証明書の所有者を検証できないため、システムのセキュリティを維持できません。 自己署名証明書は、どのような場合でも運用ネットワークには使用しないでください。  

サポートされているパラメーターは次のとおりです。 

**証明書 CRT**

- ドメイン名のプライマリ証明書ファイル
- 署名アルゴリズム = SHA256RSA
- 署名ハッシュ アルゴリズム = SHA256
- 有効期間の開始 = 有効な過去の日付
- 有効期間の終了 = 有効な将来の日付
- 公開キー = RSA 2048 ビット (最小) または 4096 ビット
- CRL 配布ポイント = .crl ファイルへの URL
- サブジェクト CN = URL (ワイルドカード証明書を使用可能)。例: www.contoso.com または \*.contoso.com
- サブジェクトの国 (C) = 定義済み。例: US
- サブジェクトの組織単位 (OU) = 定義済み。例: Contoso Labs
- サブジェクトの組織 (O) = 定義済み。例: Contoso Inc

**キー ファイル**

- CSR を作成したときに生成されたキー ファイル
- RSA 2048 ビット (最小) または 4096 ビット

**証明書チェーン**

- CA によって提供された中間証明書ファイル (存在する場合)。
- サーバーの証明書を発行した CA の証明書をファイルの先頭に配置し、その後にルートまでの他のものを配置する必要があります。 
- チェーンには、バッグ属性を含めることができます。

**パスフレーズ**

- 1 つのキーがサポートされています。
- 証明書をインポートするときに設定します。

他のパラメーターを含む証明書が機能する場合がありますが、Microsoft ではサポートされません。

#### <a name="encryption-key-artifacts"></a>暗号化キー成果物

**.pem: 証明書コンテナー ファイル**

この名前は、セキュリティで保護された電子メール用の歴史的な方法である Privacy Enhanced Mail (PEM) に由来しています。 コンテナー形式は、x509 ASN.1 キーの Base64 変換です。  

このファイルは、RFC 1421 から 1424 で定義されています。これは、パブリック証明書 (Apache インストール、CA 証明書ファイル、ETC SSL 証明書を用いるなど) のみが含まれる場合があるコンテナー形式です。 または、公開キー、秘密キー、ルート証明書など、証明書チェーン全体が含まれる場合があります。  

また、PKCS10 形式を PEM に変換できるため、CSR がエンコードされることもあります。

**.cert、.cer、.crt: 証明書コンテナー ファイル**

これは、異なる拡張子を使用した .pem  (場合によっては .der) 形式のファイルです。 Windows ファイル エクスプローラーは、これを証明書として認識します。 ファイル エクスプローラーは、.pem ファイルを認識しません。

**.key: 秘密キー ファイル**

キー ファイルは PEM ファイルと同じ形式ですが、拡張子は異なります。 

#### <a name="cli-commands"></a>CLI コマンド

`cyberx-xsense-certificate-import` CLI コマンドを使用して、証明書をインポートします。 このツールを使用するには、証明書ファイルをデバイスにアップロードする必要があります (winscp や wget などのツールを使用します)。

このコマンドは、次の入力フラグをサポートしています。

- `-h`:コマンドライン ヘルプの構文を表示します。

- `--crt`:証明書ファイル (.crt 拡張子) へのパス。

- `--key`: \*.key ファイル。 キーの長さは、2,048 ビット以上である必要があります。

- `--chain`:証明書チェーン ファイルへのパス (省略可能)。

- `--pass`:証明書の暗号化に使用されるパスフレーズ (省略可能)。

- `--passphrase-set`:既定値 = `False` (使用しない)。 前の証明書で指定された前のパスフレーズを使用するには、`True` に設定します (省略可能)。

CLI コマンドを使用する場合:

- アプライアンスで証明書ファイルが読み取り可能であることを確認します。

- 証明書のドメイン名と IP が、IT 部門が計画した構成と一致していることを確認します。

## <a name="define-backup-and-restore-settings"></a>バックアップと復元の設定を定義する

オンプレミスの管理コンソールのシステム バックアップが毎日自動的に実行されます。 データは別のディスクに保存されます。 既定の場所は `/var/cyberx/backups` です。 

このファイルを内部ネットワークに自動的に転送できます。 

> [!NOTE]
> バックアップと復元の手順は、同じバージョンでのみ実行できます。 

オンプレミスの管理コンソール マシンをバックアップするには: 

- 管理アカウントにサインインし、「`sudo cyberx-management-backup -full`」と入力します。

最新のバックアップ ファイルを復元するには:

- 管理アカウントにサインインし、「`$ sudo cyberx-management-system-restore`」と入力します。

外部の SMB サーバーにバックアップを保存するには:

1. 外部の SMB サーバーに共有フォルダーを作成します。  

   SMB サーバーへのアクセスに必要なフォルダー パス、ユーザー名、パスワードを取得します。 

2. Defender for IoT で、バックアップ用のディレクトリを作成します。

   - `sudo mkdir /<backup_folder_name_on_ server>` 

   - `sudo chmod 777 /<backup_folder_name_on_c_server>/` 

3. fstab を編集します。  

   - `sudo nano /etc/fstab` 

   - `add - //<server_IP>/<folder_path> /<backup_folder_name_on_server> cifs rw,credentials=/etc/samba/user,vers=3.0,uid=cyberx,gid=cyberx,file_mode=0777,dir_mode=0777 0 0` 

4. 共有する SMB サーバーの資格情報を編集または作成します。 

   - `sudo nano /etc/samba/user` 

5. 次の項目を追加します。 

   - `username=<user name>`

   - `password=<password>` 

6. ディレクトリをマウントします。 

   - `sudo mount -a` 

7. Defender for IoT オンプレミス管理コンソールの共有フォルダーにバックアップ ディレクトリを構成します。  

   - `sudo nano /var/cyberx/properties/backup.properties` 

   - `set Backup.shared_location to <backup_folder_name_on_server>`

## <a name="edit-the-host-name"></a>ホスト名を編集する

組織の DNS サーバーで構成されている管理コンソールのホスト名を編集するには:

1. 管理コンソールの左ペインで **[システム設定]** を選択します。  

2. コンソールのネットワーク セクションで、 **[ネットワーク]** を選択します。 

3. 組織の DNS サーバーで構成されているホスト名を入力します。 

4. **[保存]** を選択します。

## <a name="define-vlan-names"></a>VLAN 名を定義する

VLAN 名は、センサーと管理コンソールの間で同期されません。 コンポーネントで同じ名前を定義する必要があります。

ネットワーク領域で **[VLAN]** を選択し、検出された VLAN ID に名前を追加します。 次に、 **[保存]** を選択します。

## <a name="define-a-proxy-to-sensors"></a>センサーへのプロキシを定義する

ユーザーがセンサーに直接サインインできないようにすることで、システムのセキュリティを強化します。 代わりに、プロキシ トンネリングを使用して、ユーザーが 1 つのファイアウォール規則でオンプレミスの管理コンソールからセンサーにアクセスできるようにします。 この機能強化により、センサーを介してネットワーク環境に不正にアクセスされる可能性が減少します。

センサーへの直接接続がない環境では、プロキシを使用します。

:::image type="content" source="media/how-to-access-sensors-using-a-proxy/proxy-diagram.png" alt-text="ユーザー。":::

次の手順では、センサーをオンプレミスの管理コンソールに接続し、そのコンソールでトンネリングを有効にします。

1. 管理者資格情報を使用して、オンプレミスの管理コンソール アプライアンスの CLI にサインインします。

2. 「`sudo cyberx-management-tunnel-enable`」と入力し、**Enter** キーを押します。

4. 「`--port 10000`」と入力し、**Enter** キーを押します。

## <a name="adjust-system-properties"></a>システム プロパティを調整する

システム プロパティにより、管理コンソールのさまざまな操作と設定が制御されます。 それらを編集または変更すると、管理コンソールの操作に悪影響を及ぼす可能性があります。 設定を変更する前に、[Microsoft サポート](https://support.microsoft.com)にお問い合わせください。

システム プロパティにアクセスするには: 

1. オンプレミスの管理コンソールまたはセンサーにサインインします。

2. **[システム設定]** を選択します。

3. **[全般]** セクションで **[システム プロパティ]** を選択します。

## <a name="change-the-name-of-the-on-premises-management-console"></a>オンプレミスの管理コンソールの名前を変更する

オンプレミスの管理コンソールの名前を変更できます。 コンソール Web ブラウザー、さまざまなコンソール ウィンドウ、トラブルシューティング ログに新しい名前が表示されます。 既定の名前は **管理コンソール** です。

名前を変更するには:

1. 左ペインの下部で、現在の名前を選択します。

   :::image type="content" source="media/how-to-change-the-name-of-your-azure-consoles/console-name.png" alt-text="オンプレミスの管理コンソール バージョンのスクリーンショット。":::

2. **[Edit management console configuration]\(管理コンソールの構成の編集\)** ダイアログ ボックスで、新しい名前を入力します。 名前は 25 文字以下にする必要があります。

   :::image type="content" source="media/how-to-change-the-name-of-your-azure-consoles/edit-management-console-configuration.png" alt-text="Defender for IoT プラットフォーム構成の編集のスクリーンショット。":::

3. **[保存]** を選択します。 新しい名前が適用されます。

   :::image type="content" source="media/how-to-change-the-name-of-your-azure-consoles/name-changed.png" alt-text="変更されたコンソール名を示すスクリーンショット。":::

## <a name="password-recovery"></a>パスワードの回復

オンプレミスの管理コンソールのパスワードの回復は、デバイスがアタッチされているサブスクリプションに関連付けられています。 デバイスがアタッチされているサブスクリプションがわからない場合、パスワードを回復することはできません。

パスワードをリセットするには:

1. オンプレミスの管理コンソールのサインイン ページに移動します。
1. **[パスワードの回復]** を選択します。
1. 一意識別子をコピーします。
1. Defender for IoT の **[サイトとセンサー]** ページに移動し、 **[パスワードの回復]** タブを選択します。
1. 一意識別子を入力し、 **[回復]** を選択します。 アクティブ化ファイルがダウンロードされます。
1. **[パスワードの回復]** ページに移動し、アクティブ化ファイルをアップロードします。
1. **[次へ]** を選択します。
 
   これで、ユーザー名と、システムによって生成された新しいパスワードが付与されます。

> [!NOTE]
> センサーは、最初に接続されていたサブスクリプションにリンクされます。 パスワードは、アタッチ先のサブスクリプションと同じものを使用してのみ回復できます。

## <a name="see-also"></a>関連項目

[管理コンソールからセンサーを管理する](how-to-manage-sensors-from-the-on-premises-management-console.md)

[個々のセンサーの管理](how-to-manage-individual-sensors.md)
