---
title: Azure Front Door の構成に関する問題のトラブルシューティング
description: このチュートリアルでは、Front Door で発生する可能性のある、一般的な問題のいくつかを自己解決する方法を説明します。
services: frontdoor
documentationcenter: ''
author: duongau
editor: ''
ms.service: frontdoor
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 09/30/2020
ms.author: duau
ms.openlocfilehash: dbce9019e33c07dd4faa91ffd490eba4d313c675
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/09/2020
ms.locfileid: "91630612"
---
# <a name="troubleshooting-common-routing-issues"></a>ルーティングの一般的な問題のトラブルシューティング

この記事では、Azure Front Door の構成で、よく発生する可能性のあるルーティングの問題をトラブルシューティングする方法について説明します。

## <a name="503-response-from-front-door-after-a-few-seconds"></a>数秒後に Front Door から 503 応答

### <a name="symptom"></a>症状

* Front Door を経由せずにバックエンドに送信される通常の要求は成功しますが、Front Door を経由すると 503 エラー応答が返されます。
* Front Door からのエラーが数秒後 (通常は約 30 秒後) に表示されます

### <a name="cause"></a>原因

この問題の原因は、次の 2 つのどちらかである可能性があります。
 
* バックエンドで、Front Door から要求を受信するために構成したタイムアウト (既定値は 30 秒) よりも長い時間がかかっています。
* Front Door からの要求に対して応答を送信するのに、タイムアウト値よりも長い時間がかかっています。 

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

* バックエンドに要求を直接 (Front Door を経由せずに) 送信し、バックエンドが応答に要する通常の時間を確認します。
* Front Door 経由で要求を送信し、503 応答を受け取るかどうかを確認します。 そうでない場合は、タイムアウトの問題ではない可能性があります。 サポートにお問い合せください。
* Front Door を経由したときに 503 エラー応答コードが生成される場合は、Front Door の `sendReceiveTimeout` フィールドを構成します。 既定のタイムアウトは、最大 4 分 (240 秒) まで延長できます。 この設定は `backendPoolSettings` の下にあり、`sendRecvTimeoutSeconds` と呼ばれます。 

## <a name="requests-sent-to-the-custom-domain-returns-400-status-code"></a>カスタム ドメインに送信された要求で 400 状態コードが返される

### <a name="symptom"></a>症状

* Front Door を作成しましたが、ドメインまたはフロントエンド ホストへの要求で HTTP 400 の状態コードが返されます。
* カスタム ドメインに対して構成したフロントエンド ホストへの DNS マッピングを作成しました。 しかし、カスタム ドメインのホスト名に要求を送信すると、HTTP 400 の状態コードが返されます。 構成したバックエンドにルーティングされているようには見えません。

### <a name="cause"></a>原因

この問題は、フロントエンド ホストとして追加されたカスタム ドメインに対してルーティング規則を構成しなかった場合に発生します。 そのフロントエンド ホストに対して明示的にルーティング規則を追加する必要があります。 Front Door サブドメイン (*.azurefd.net) 下でフロントエンド ホストに対して規則が既に構成されている場合も該当します。

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

カスタム ドメインに対して、選択したバックエンド プールにトラフィックを転送するルーティング規則を追加します。

## <a name="front-door-doesnt-redirect-http-to-https"></a>Front Door によって HTTP が HTTPS にリダイレクトされない

### <a name="symptom"></a>症状

フロント ドアには HTTP を HTTPS にリダイレクトするルーティング規則がありますが、ドメインへのアクセスではプロトコルとして HTTP が維持されます。

### <a name="cause"></a>原因

この動作は、Front Door のルーティング規則を正しく構成していない場合に発生する可能性があります。 基本的に、現在の構成は固有ではなく、規則が競合している可能性があります。

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

## <a name="request-to-frontend-hostname-returns-404-status-code"></a>フロントエンドのホスト名の要求で状態コード 404 が返される

### <a name="symptom"></a>症状

 フロントエンド ホスト、少なくとも 1 つ以上のバックエンドがあるバックエンド プール、フロントエンド ホストをバックエンド プールに接続するルーティング規則を構成して、Front Door を作成しました。 構成したフロントエンド ホストに要求を送信しても、結果として HTTP 404 の状態コードが返されるため、コンテンツを利用できません。

### <a name="cause"></a>原因

この現象には、以下のような複数の原因が考えられます。

* バックエンドが一般向けのバックエンドではなく、Front Door から参照できません。
* バックエンドが正しく構成されていないため、Front Door から間違った要求が送信されています。 つまり、バックエンドでは HTTP だけが受け入れられ、HTTPS の許可がオフになっていません。 そのため、Front Door では HTTPS 要求を転送しようとします。
* バックエンドが、バックエンドへの要求で送信されたホスト ヘッダーを拒否しています。
* バックエンドの構成が、まだ完全にはデプロイされていません。

### <a name="troubleshooting-steps"></a>トラブルシューティングの手順

1. デプロイ時間
   * 構成がデプロイされるまで確実に 10 分間は待ちます。

2. バックエンドの設定を確認する
    * 要求がルーティングされるべきバックエンド プール (ルーティング規則の構成方法によって異なります) に移動します。 "*バックエンド ホストの種類*" とバックエンドのホスト名が正しいことを確認します。 バックエンドがカスタム ホストの場合は、スペルが正しく入力されていることを確認します。 

    * HTTP および HTTPS ポートを確認します。 多くの場合、80 と 443 が (それぞれ) 正しく、変更をする必要はありません。 ただし、バックエンドの構成がこのようにはなっておらず、別のポートをリッスンしている場合もあります。

        * フロントエンド ホストのルート先のバックエンドに構成されている _バックエンド ホスト ヘッダー_ を確認します。 多くの場合、このヘッダーは *バックエンド ホスト名* と同じである必要があります。 ただし、バックエンドが別のものを期待している場合、不正な値によってさまざまな HTTP 4xx の状態コードが発生する場合があります。 バックエンドの IP アドレスを入力した場合、*バックエンドのホスト ヘッダー* をバックエンドのホスト名に設定する必要があります。

3. ルーティング規則の設定を確認する:
    * 問題のフロントエンド ホスト名からバックエンド プールにルーティングする、ルーティング規則に移動します。 要求を転送するときに、許可されているプロトコルが正しく構成されていることを確認します。 *[accepted protocols]\(許可されているプロトコル\)* フィールドによって、Front Door で受け入れられる要求が決定されます。 *[転送プロトコル]* によって、Front Door でバックエンドに要求を転送するために使用されるプロトコルが決定されます。
         * たとえば、バックエンドが HTTP 要求のみを許可している場合、次の構成が有効になります。
            * *[accepted protocols]* \(許可されているプロトコル\) は、HTTP および HTTPS です。 *[転送プロトコル]* は HTTP です。 HTTPS は許可されているプロトコルであるため、一致要求は機能しません。要求が HTTPS で受信された場合、Front Door は HTTPS を使用してそれを転送します。

            * *[accepted protocols]* \(許可されているプロトコル\) は、HTTP です。 *[転送プロトコル]* は、一致要求または HTTP です。

    - *[Url の書き換え]* は、既定では無効化されています。 このフィールドは、バックエンドでホストされているリソースの利用可能にする範囲を限定したい場合にのみ使用します。 これを無効にすると、Front Door は受信したのと同じ要求パスを転送します。 このフィールドを間違って構成する可能性があります。 その場合、Front Door によって、利用できないバックエンドのリソースが要求されると、HTTP 404 の状態コードが返されます。
