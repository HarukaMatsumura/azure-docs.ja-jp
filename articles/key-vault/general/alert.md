---
title: Azure Key Vault のアラート
description: キー コンテナーの正常性を監視しアラートを構成するためのダッシュボードを作成します。
services: key-vault
author: msmbaldwin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: how-to
ms.date: 03/31/2021
ms.author: mbaldwin
ms.openlocfilehash: 4c1f63bdc13822b7eb48dc5410a990dc75f3453e
ms.sourcegitcommit: 48500a6a9002b48ed94c65e9598f049f3d6db60c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/26/2021
ms.locfileid: "129060784"
---
# <a name="alerting-for-azure-key-vault"></a>Azure Key Vault のアラート

## <a name="overview"></a>概要

キー コンテナーを使用した運用環境のシークレットの保管を開始した後は、サービスが意図したとおりに動作しているか確認するために、キー コンテナーの正常性を監視することが重要です。 サービスのスケーリングを開始すると、キー コンテナーに送信される要求の数が増加します。 これにより要求の待機時間が長くなる可能性があり、極端な場合には要求がスロットルされてサービスのパフォーマンスに影響を与えます。 また、アクセス ポリシーやファイアウォールの構成の問題についてすぐに通知を受けられるように、キー コンテナーが異常な数のエラー コードを送信している場合にアラートを受け取る必要があります。 このドキュメントでは、次のトピックについて説明します。

+ 監視する基本的な Key Vault メトリック
+ メトリックの構成方法とダッシュボードの作成方法
+ 指定したしきい値でアラートを作成する方法

Azure Monitor for Key Vault では、ログとメトリックの組み合わせによる、グローバルな監視ソリューションが用意されています。 [Azure Monitor for Key Vault の詳細はこちらからご確認ください](../../azure-monitor/insights/key-vault-insights-overview.md#introduction-to-key-vault-insights)

## <a name="how-to-configure-alerts-on-your-key-vault"></a>Key Vault でアラートを構成する方法 

このセクションでは、キー コンテナーの状態が正常でない場合にすぐに対処するようにチームに警告できるように、キー コンテナーでアラートを構成する方法について説明します。 電子メールを (望ましくは) チーム DL に送信したり、Event Grid 通知を起動したり、電話番号に発信したりテキストを送信したりするアラートを構成できます。 固定値に基づいて静的アラートを選択することもできます。また、監視対象のメトリックが、定義された時間範囲内でキー コンテナーの平均値を一定回数超えた場合にアラートを生成する動的アラートを選択することもできます。 

> [!IMPORTANT]
> 新しく構成されたアラートが通知の送信を開始するまでに最大 10 分かかる場合があることに注意してください。 

### <a name="configure-an-action-group"></a>アクション グループを構成する 

アクション グループは、通知とプロパティの構成可能な一覧です。

1. Azure portal にログインします
2. 検索ボックスで「**アラート**」を検索します。
3. **[アクションの管理]** を選択します。

> [!div class="mx-imgBorder"]
> ![[アクションの管理] ボタンが強調表示されているスクリーンショット。](../media/alert-6.png)

4. **[+ アクション グループの追加]** を選択します。

> [!div class="mx-imgBorder"]
> ![[+ アクション グループの追加] ボタンが強調表示されているスクリーンショット。](../media/alert-7.png)

5. アクション グループの **[アクションの種類]** を選択します。 この例では、電子メール アラートを作成します。

> [!div class="mx-imgBorder"]
> ![アクション グループを追加するために必要なフィールドが強調表示されているスクリーンショット。](../media/alert-8.png)

> [!div class="mx-imgBorder"]
> ![電子メールまたは SMS メッセージ アラートを追加するために必要なものを示しているスクリーンショット。](../media/alert-9.png)

6. ページの下部にある **[OK]** をクリックします。 アクション グループの作成が正常に完了しました。 

アクション グループの構成が完了したので、キー コンテナー アラートのしきい値を構成します。 

### <a name="configure-alert-thresholds"></a>アラートのしきい値を構成する 

1. Azure portal でキー コンテナー リソースを選択し、 **[監視]** の下にある **[アラート]** を選択します。

> [!div class="mx-imgBorder"]
> ![[モニター] セクションの [アラート] メニューを示しているスクリーンショット。](../media/alert-10.png)

2. **[新しいアラート ルール]** を選択します。

> [!div class="mx-imgBorder"]
> ![[+ 新しいアラート ルール] ボタンを示しているスクリーンショット。](../media/alert-11.png)

3. アラート ルールのスコープを選択します。 1 つまたは複数のコンテナーを選択できます。 

> [!IMPORTANT]
> アラートのスコープに対して複数のコンテナーを選択する場合は、選択したすべてのコンテナーが同じリージョンに存在する必要があることに注意してください。 異なるリージョンのコンテナーに対して個別のアラート ルールを構成する必要があります。 

> [!div class="mx-imgBorder"]
> ![コンテナーの選択方法を示しているスクリーンショット。](../media/alert-12.png)

4. アラートの条件を選択します。 次のいずれかのシグナルを選択して、アラートのロジックを定義できます。 Key Vault チームでは、次のアラートのしきい値を構成することをお勧めします。 

    + Key Vault の可用性が 100% を下回る (静的しきい値)
    + Key Vault の待機時間が 500 ミリ秒を超える (静的しきい値) 
    + コンテナーの全体的な飽和度が 75% を超える (静的しきい値) 
    + コンテナーの全体的な飽和度が平均を超える (動的しきい値)
    + エラー コードの総数が平均を超える (動的しきい値) 

> [!div class="mx-imgBorder"]
> ![アラートの条件を選択する場所を示しているスクリーンショット。](../media/alert-13.png)

### <a name="example-1-configuring-a-static-alert-threshold-for-latency"></a>例 1:待機時間に対する静的アラートのしきい値の構成

シグナル名として **[サービス API の全体的な待機時間]** を選択します。
> [!div class="mx-imgBorder"]
> ![[サービス API の全体的な待機時間] シグナル名を示しているスクリーンショット。](../media/alert-14.png)

次の構成パラメーターを確認してください。

+ [しきい値] を **[静的]** に設定します 
+ [演算子] を **[より大きい]** に設定します
+ [集計の種類] を **[平均]** に設定します
+ [しきい値] を **[500]** に設定します
+ [Aggregation Period]\(集計期間\) を **[5 分]** に設定します
+ [評価の頻度] を **[1 分]** に設定します
+ **[完了]** を選択します  

> [!div class="mx-imgBorder"]
> ![構成されたアラート ロジックが強調表示されているスクリーンショット。](../media/alert-15.png)

### <a name="example-2-configuring-a-dynamic-alert-threshold-for-vault-saturation"></a>例 2:コンテナーの飽和度に対する動的アラートのしきい値の構成 

動的アラートを使用すると、選択したキー コンテナーの履歴データを表示できるようになります。 青色の領域は、キー コンテナーの平均使用量を表します。 赤色の領域は、アラート構成の他の条件が満たされた場合にアラートをトリガーするスパイクを示しています。 赤色の点は、集約期間の時間枠でアラートの条件が満たされた違反のインスタンスを示します。 設定した時間内に特定の数の違反が発生した後に起動するようにアラートを設定できます。 過去のデータを含めたくない場合は、以下の詳細設定で古いデータを除外するオプションがあります。 

> [!div class="mx-imgBorder"]
> ![コンテナーの全体的な飽和状態のグラフを示しているスクリーンショット。](../media/alert-16.png)

次の構成パラメーターを確認してください。

+ [しきい値] を **[動的]** に設定します 
+ [演算子] を **[より大きい]** に設定します
+ [集計の種類] を **[平均]** に設定します
+ [しきい値の感度] を **[中]** に設定します
+ [Aggregation Period]\(集計期間\) を **[5 分]** に設定します
+ [評価の頻度] を **[1 分]** に設定します
+ **(オプション)** 詳細設定を構成します 
+ **[完了]** を選択します

> [!div class="mx-imgBorder"]
> ![Azure portal のスクリーンショット](../media/alert-17.png)

5. 構成したアクション グループを追加します

> [!div class="mx-imgBorder"]
> ![アクション グループの追加方法を示しているスクリーンショット。](../media/alert-18.png)

6. アラートを有効にして重要度を割り当てます

> [!div class="mx-imgBorder"]
> ![アラートの有効化と重大度の割り当てを行う場所を示しているスクリーンショット。](../media/alert-19.png)

7. アラートを作成する 

### <a name="example-email-alert"></a>電子メール アラートの例 

> [!div class="mx-imgBorder"]
> ![電子メール アラートを構成するために必要な情報が強調表示されているスクリーンショット。](../media/alert-20.png)

## <a name="next-steps"></a>次のステップ

これで、監視ダッシュボードが正常に作成され、キー コンテナーのアラートが構成されました。

上記のすべての手順を実行すると、構成したアラート条件をキー コンテナーが満たした場合に電子メール アラートが届きます。 次に例を示します。 この記事で設定したツールを使用して、キー コンテナーの正常性をアクティブに監視します。

- [キー コンテナーの監視](monitor-key-vault.md)
- [Key Vault データ参照の監視](monitor-key-vault-reference.md)