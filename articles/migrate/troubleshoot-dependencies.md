---
title: エージェントレスおよびエージェントベースの依存関係分析に関する問題のトラブルシューティング
description: Azure Migrate での依存関係の視覚化に役立ちます。
author: Vikram1988
ms.author: vibansa
ms.manager: abhemraj
ms.topic: troubleshooting
ms.date: 07/01/2020
ms.openlocfilehash: 7e618052a71f73c5559860fa09b495e9be2a14d9
ms.sourcegitcommit: 8b7d16fefcf3d024a72119b233733cb3e962d6d9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/16/2021
ms.locfileid: "114290982"
---
# <a name="troubleshoot-dependency-visualization"></a>依存関係の視覚化に関するトラブルシューティング

この記事は、エージェントベースおよびエージェントレスの依存関係分析に関する問題のトラブルシューティングに役立ちます _(VMware サーバーでのみ使用できます)_ 。 Azure Migrate でサポートされている依存関係の視覚化の種類の詳細については、[こちら](concepts-dependency-visualization.md)をご覧ください。


## <a name="visualize-dependencies-for--1-hour-with-agentless-dependency-analysis"></a>エージェントレスの依存関係分析を使用して 1 時間未満分の依存関係を視覚化する

エージェントレスの依存関係の分析では、最大 30 日間、マップ内で依存関係を視覚化したりエクスポートしたりできます。

## <a name="visualized-dependencies-for--10-servers-with-agentless-dependency-analysis"></a>エージェントレスの依存関係分析を使用して 10 台未満のサーバーの依存関係を視覚化する

Azure Migrate には、一度に多数のサーバーのネットワーク接続を視覚化し、プロセスとサーバーによってフィルター処理するために使用できる Power BI テンプレートが用意されています。 多数のサーバーの依存関係を視覚化する方法の詳細については、[こちら](how-to-create-group-machine-dependencies-agentless.md#visualize-network-connections-in-power-bi)をご覧ください。

## <a name="dependencies-export-csv-shows-unknown-process-with-agentless-dependency-analysis"></a>依存関係のエクスポートの CSV にエージェントレスの依存関係分析に関する "不明なプロセス" が表示される
エージェントレスの依存関係の分析では、プロセス名はベストエフォートでキャプチャされます。 特定のシナリオでは、依存元と依存先のサーバー名および依存先のポートはキャプチャされますが、依存関係の両端でプロセス名を特定することはできません。 このような場合、プロセスは "_不明なプロセス_" とマークされます。

## <a name="common-agentless-dependency-analysis-errors"></a>エージェントレス依存関係分析の一般的なエラー

Azure Migrate でサポートされるエージェントレスの依存関係分析では、Azure Migrate: Discovery and Assessment を使用します。 エージェントレスの依存関係分析は現在、VMware のみでサポートされています。 エージェントレスの依存関係分析の要件については、[こちら](how-to-create-group-machine-dependencies-agentless.md)をご覧ください。

下の表に、エージェントレスの依存関係分析エラーの一覧をまとめます。

> [!Note]
> 同じエラーがソフトウェア インベントリでも発生する可能性があります。理由は、エージェントレスの依存関係分析と同様の方法で必要なデータを収集するからです。

| **Error** | **原因** | **操作** |
|--|--|--|
| **9000:** サーバー上の VMware ツールの状態を検出できません | VMware ツールがサーバーにインストールされていないか、インストールされているバージョンが破損している可能性があります。 | バージョン 10.2.1 より後の VMware ツールがサーバーにインストールされ、実行されていることを確認してください。 |
| **9001:** VMware ツールがサーバーにインストールされていません。 | VMware ツールがサーバーにインストールされていないか、インストールされているバージョンが破損している可能性があります。 | バージョン 10.2.1 より後の VMware ツールがサーバーにインストールされ、実行されていることを確認してください。 |
| **9002:** VMware ツールがサーバーで実行されていません。 | VMware ツールがサーバーにインストールされていないか、インストールされているバージョンが破損している可能性があります。 | バージョン 10.2.0 より後の VMware ツールがサーバーにインストールされ、実行されていることを確認してください。 |
| **9003:** サーバーで実行されているオペレーティング システムの種類はサポートされていません。 | サーバーで実行されているオペレーティング システムが Windows でも Linux でもありません。 | サポートされている OS の種類は Windows と Linux だけです。 サーバーが確かに Windows または Linux OS を実行している場合は、vCenter Server で指定されているオペレーティング システムの種類を確認してください。 |
| **9004:** サーバーが実行中の状態ではありません。 | サーバーが電源オフの状態です。 | サーバーが実行中の状態であることを確認してください。 |
| **9005:** サーバーで実行されているオペレーティング システムの種類はサポートされていません。 | サーバーで実行されているオペレーティング システムが Windows でも Linux でもありません。 | サポートされている OS の種類は Windows と Linux だけです。 \<FetchedParameter> オペレーティング システムは現在サポートされていません。 |
| **9006:** サーバーから探索メタデータ ファイルをダウンロードするために必要な URL が空です。 | これは、アプライアンス上の検出エージェントが想定どおりに動作していない場合に発生する一時的な問題である可能性があります。 | この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9007:** スクリプトを実行してメタデータを収集するプロセスがサーバーに見つかりません。 | これは、アプライアンス上の検出エージェントが想定どおりに動作していない場合に発生する一時的な問題である可能性があります。 | この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9008:** メタデータを収集するためにサーバーで実行されているプロセスの状態を取得できません。 | これは一時的な問題で、内部エラーが原因の可能性があります。 | この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9009:** Windows ユーザー アカウント制御 (UAC) が、サーバーでの検出操作の実行を妨げています。 | Windows ユーザー アカウント制御 (UAC) の設定により、インストールされているアプリケーションをサーバーから検出することが制限されています。 | 影響を受けるサーバーのコントロール パネルで、[ユーザー アカウント制御の設定] のレベルを下げてください。 |
| **9010:** サーバーの電源がオフになっています。 | サーバーが電源オフの状態です。 | サーバーの電源オンの状態になるようにしてください。 |
| **9011:** 検出されたメタデータを含むファイルがサーバーに見つかりません。 | これは一時的な問題で、内部エラーが原因の可能性があります。 | この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9012:** サーバー上の、検出されたメタデータを格納するファイルは空です。 | これは一時的な問題で、内部エラーが原因の可能性があります。 | この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9013:** サーバーへログインするごとに、新しい一時ユーザー プロファイルが作成されています。 | サーバーへログインするごとに、新しい一時ユーザー プロファイルが作成されています。 | Microsoft サポート ケースを送信して、この問題のトラブルシューティングの支援を受けてください。 |
| **9014:** ESXi ホストでエラーが発生し、検出されたメタデータを含むファイルを取得できません。  エラー コード: %ErrorCode、詳細: %ErrorMessage | ESXi ホスト \<HostName> でエラーが発生しました。  エラー コード: %ErrorCode、詳細: %ErrorMessage | サーバーが実行されている ESXi ホストでポート 443 が開いていることを確認してください。<br/><br/> この問題の修復方法については、[こちら](troubleshoot-dependencies.md#error-9014-httpgetrequesttoretrievefilefailed)をご覧ください。|
| **9015:** サーバー検出で指定された vCenter Server ユーザー アカウントのゲスト操作権限が有効になっていません。 | 必要なゲスト操作の権限が vCenter Server ユーザー アカウントで有効になっていません。 | サーバーに接触して必要なデータをプルするために、[仮想マシン] > [ゲスト操作] で有効になっている権限が vCenter Server ユーザー アカウントにあることを確認してください。 <br/><br/> 必要な権限を持つ vCenter Server アカウントを設定する方法の詳細については、[こちら](tutorial-discover-vmware.md#prepare-vmware)をご覧ください。 |
| **9016:** サーバー上のゲスト操作エージェントが古くなっているので、メタデータを検出できません。 | VMware ツールがサーバーにインストールされていないか、インストールされているバージョンが最新ではありません。 | VMware ツールがサーバーにインストールされ、最新の状態のものが実行されていることを確認してください。 VMware ツールのバージョンは、バージョン 10.2.1 以降である必要があります。 |
| **9017:** 検出されたメタデータを含むファイルがサーバーに見つかりません。 | これは一時的な問題で、内部エラーが原因の可能性があります。 | Microsoft サポート ケースを送信して、この問題のトラブルシューティングの支援を受けてください。 |
| **9018:** PowerShell がサーバーにインストールされていません。 | PowerShell がサーバーに見つかりません。 | PowerShell バージョン 2.0 以降がサーバーにインストールされていることを確認してください。 <br/><br/> この問題の修復方法については、[こちら](troubleshoot-dependencies.md#error-9018-powershellnotfound)をご覧ください。|
| **9019:** サーバーでのゲスト操作エラーが原因でメタデータを検出できません。 | VMware ゲスト操作がサーバーで失敗しました。この問題は、サーバーで次の資格情報を試す際に発生しました: <FriendlyNameOfCredentials>。 | アプライアンスで指定されたサーバーの資格情報が有効であること、資格情報で指定されたユーザー名が UPN 形式であることを確認してください。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください) |
| **9020:** 検出されたメタデータをサーバーに格納するために必要なファイルを作成できません。 | アプライアンスで指定された資格情報に関連付けられているロールまたはオンプレミスのグループ ポリシーによって、必要なフォルダーでのファイル作成が制限されています。 この問題は、サーバーで次の資格情報を試す際に発生しました: <FriendlyNameOfCredentials>。 | 1. アプライアンスに指定された資格情報にサーバーのフォルダー \<folder path/folder name> でのファイル作成のアクセス許可があるか確認します。 <br/>2. アプライアンスで指定された資格情報に必要なアクセス許可がない場合は、別の資格情報セットを指定するか、既存のものを編集します。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください) |
| **9021:** 検出されたメタデータを格納するために必要なファイルをサーバー上の正しいパスで作成できません。 | VMware ツールから、ファイルを作成するためのファイル パスが正しくないことが報告されています。 | バージョン 10.2.0 より後の VMware ツールがサーバーにインストールされ、実行されていることを確認してください。 |
| **9022:** Get-WmiObject コマンドレットをサーバーで実行するためのアクセスが拒否されました。 | アプライアンスで指定された資格情報に関連付けられているロール、またはオンプレミスのグループ ポリシーが、WMI オブジェクトへのアクセスを制限しています。 この問題は、サーバーで次の資格情報を試す際に発生しました: \<FriendlyNameOfCredentials>。 | 1. アプライアンスで指定された資格情報にファイル作成管理者権限があるか、また、WMI が有効になっているかを確認します。 <br/> 2. アプライアンスで指定された資格情報に必要なアクセス許可がない場合は、別の資格情報セットを指定するか、既存のものを編集します。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください)。<br/><br/> この問題の修復方法については、[こちら](troubleshoot-dependencies.md#error-9022-getwmiobjectaccessdenied)をご覧ください。|
| **9023:** %SystemRoot% 環境変数の値が空であるため、PowerShell を実行できません。 | このサーバーの %SystemRoot% 環境変数の値が空です。 | 1. 影響を受けているサーバーで echo %systemroot% コマンドを実行して、この環境変数が空の値を返しているか調べます。 <br/> 2. 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9024:** %TEMP% 環境変数の値が空であるため、検出を実行できません。 | このサーバーの %TEMP% 環境変数の値が空です。 | 1. 影響を受けているサーバーで echo %temp% コマンドを実行して、この環境変数が空の値を返しているか調べます。 <br/> 2. 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9025:** 検出を実行できません。サーバー上の PowerShell が破損しています。 | サーバー上の PowerShell が破損しています。 | 影響を受けるサーバーで PowerShell を再インストールして、それが実行されていることを確認してください。 |
| **9026:** サーバーでゲスト操作を実行できません。 | サーバーの現在の状態では、ゲスト操作は実行できません。 | 1. 影響を受けるサーバーが稼働中であることを確認します。<br/> 2. 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **9027:** サーバー上でゲスト操作エージェントはサーバー上が実行されていないため、メタデータを検出できません。 | サーバー上のゲスト操作エージェントにアクセスできません。 | バージョン 10.2.0 より後の VMware ツールがサーバーにインストールされ、実行されていることを確認してください。 |
| **9028:** サーバー上のストレージが足りないため、検出されたメタデータを格納するために必要なファイルを作成できません。 | サーバー ディスクのストレージ領域が不足しています。 | 影響を受けるサーバーのディスク ストレージに十分な領域を確保してください。 |
| **9029:** アプライアンスで指定された資格情報には、PowerShell を実行するためのアクセス許可が付与されていません。 | アプライアンスで指定された資格情報には、PowerShell を実行するためのアクセス許可が付与されていません。 この問題は、サーバーで次の資格情報を試す際に発生しました: \<FriendlyNameOfCredentials>。 | 1. アプライアンスで指定された資格情報でサーバー上の PowerShell にアクセスできることを確認します。<br/> 2. アプライアンスで指定された資格情報に必要なアクセス権がない場合は、別の資格情報セットを指定するか、既存のものを編集します。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください) |
| **9030:** サーバーがホストされている ESXi ホストが切断状態であるため、検出されたメタデータを収集できません。 | サーバーが存在している ESXi ホストは切断状態です。 | サーバーを実行している ESXi ホストが接続状態であるか確認してください。 |
| **9031:** サーバーがホストされている ESXi ホストが応答していないため、検出されたメタデータを収集できません。 | サーバーが存在している ESXi ホストは無効な状態です。 | サーバーを実行している ESXi ホストが実行中で接続済みの状態であることを確認してください。 |
| **9032:** 内部エラーのため、検出できません。 | この問題は内部エラーが原因で発生しました。 | [こちら](troubleshoot-dependencies.md#error-9032-invalidrequest)の手順に従って、問題を修復してください。 問題が解決しない場合は、Microsoft サポート ケースを開いてください。 |
| **9033:** サーバーのアプライアンスで指定された資格情報のユーザー名に無効な文字が含まれているため、検出できません。 | アプライアンスに指定された資格情報のユーザー名に無効な文字が含まれています。 この問題は、サーバーで次の資格情報を試す際に発生しました: \<FriendlyNameOfCredentials>。 | アプライアンスで指定された資格情報のユーザー名に無効な文字が含まれないようにしてください。 アプライアンス構成マネージャーに戻って、資格情報を編集できます。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください)。 |
| **9034:** サーバーのアプライアンスで指定された資格情報のユーザー名は UPN 形式でないため、検出できません。 | アプライアンスで指定された資格情報には、UPN 形式のユーザー名がありません。 この問題は、サーバーで次の資格情報を試す際に発生しました: \<FriendlyNameOfCredentials>。 | アプライアンスで指定された資格情報のユーザー名がユーザー プリンシパル名 (UPN) 形式になるようにしてください。 アプライアンス構成マネージャーに戻って、資格情報を編集できます。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください)。 |
| **9035:** PowerShell の言語モードが正しく設定されていないため、検出できません。 | PowerShell の言語モードが "完全言語" に設定されていません。 | PowerShell の言語モードが "完全言語" に設定されていることを確認します。 |
| **9036:** サーバーのアプライアンスで指定された資格情報のユーザー名が UPN 形式でないため、検出できません。 | アプライアンスで指定された資格情報には、UPN 形式のユーザー名がありません。 この問題は、サーバーで次の資格情報を試す際に発生しました: \<FriendlyNameOfCredentials>。 | アプライアンスで指定された資格情報のユーザー名がユーザー プリンシパル名 (UPN) 形式になるようにしてください。 アプライアンス構成マネージャーに戻って、資格情報を編集できます。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください)。 |
| **9037:** サーバーからの応答時間が長いため、メタデータ収集が一時的に中断しています。 | サーバーの応答に時間がかかりすぎています。 | この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **10000:** サーバーで実行されているオペレーティング システムの種類はサポートされていません。 | サーバーで実行されているオペレーティング システムが Windows でも Linux でもありません。 | サポートされている OS の種類は Windows と Linux だけです。 \<GuestOSName> オペレーティング システムは現在サポートされていません。 |
| **10001:** 検出メタデータを収集するために必要なスクリプトがサーバー上に見つかりません。 | 検出を実行するために必要なスクリプトが、想定された場所から削除または除去された可能性があります。 | Microsoft サポート ケースを送信して、この問題のトラブルシューティングの支援を受けてください。 |
| **10002:** サーバーで検出操作がタイムアウトになりました。 | これは、アプライアンス上の検出エージェントが想定どおりに動作していない場合に発生する一時的な問題である可能性があります。 | この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 解決しない場合は、[こちら](troubleshoot-dependencies.md#error-10002-scriptexecutiontimedoutonvm)の手順に従って問題を修復してください。 それでも問題が解決しない場合は、Microsoft サポート ケースを開いてください。|
| **10003:** 検出操作を実行するプロセスがエラーで終了しました。 | 検出操作を実行するプロセスが、エラーのため突然終了しました。| この問題は通常、24 時間以内に次のサイクルで自動的に解決されます。 問題が解決しない場合は、Microsoft サポート ケースを送信してください。 |
| **10004:** サーバー OS の種類の資格情報が、アプライアンスで指定されませんでした。 | サーバー OS の種類の資格情報がアプライアンスで追加されていませんでした。 | 1. 影響を受けるサーバーの OS の種類の資格情報をアプライアンスで追加してください。<br/> 2. 複数のサーバー資格情報をアプライアンスで追加できるようになりました。 |
| **10005:** アプライアンスで指定された、サーバーの資格情報が無効です。 | アプライアンスで指定された資格情報が無効です。 この問題は、サーバーで次の資格情報を試す際に発生しました: \<FriendlyNameOfCredentials>。 | 1. アプライアンスで指定された資格情報が有効であること、この資格情報を使用してサーバーにアクセスできることを確認します。<br/> 2. 複数のサーバー資格情報をアプライアンスで追加できるようになりました。<br/> 3. アプライアンス構成マネージャーに戻り、別の資格情報のセットを指定するか、既存のものを編集します。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください)。 <br/><br/> この問題の修復方法については、[こちら](troubleshoot-dependencies.md#error-10005-guestcredentialnotvalid)をご覧ください。|
| **10006:** サーバーで実行されているオペレーティング システムの種類はサポートされていません。 | サーバーで実行されているオペレーティング システムが Windows でも Linux でもありません。 | サポートされている OS の種類は Windows と Linux だけです。 \<GuestOSName> オペレーティング システムは現在サポートされていません。 |
| **10007:** サーバーからの検出されたメタデータを処理できません。 | 検出されたメタデータを含むファイルの内容を解析しているときエラーが発生しました。 | Microsoft サポート ケースを送信して、この問題のトラブルシューティングの支援を受けてください。 |
| **10008:** 検出されたメタデータを格納するために必要なファイルをサーバーに作成できません。 | アプライアンスで指定された資格情報に関連付けられているロールまたはオンプレミスのグループ ポリシーによって、必要なフォルダーでのファイル作成が制限されています。 この問題は、サーバーで次の資格情報を試す際に発生しました: <FriendlyNameOfCredentials>。 | 1. アプライアンスに指定された資格情報にサーバーのフォルダー \<folder path/folder name> でのファイル作成のアクセス許可があるか確認します。<br/> 2. アプライアンスで指定された資格情報に必要なアクセス許可がない場合は、別の資格情報セットを指定するか、既存のものを編集します。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください) |
| **10009:** 検出されたメタデータをサーバー上のファイルに書き込めません。 | アプライアンスで指定された資格情報に関連付けられているロール、またはオンプレミスのグループ ポリシーによって、サーバー上のファイルへの書き込みが制限されています。 この問題は、サーバーで次の資格情報を試す際に発生しました: \<FriendlyNameOfCredentials>。 | 1. アプライアンスで指定された資格情報に、サーバーのフォルダー <フォルダー パス/フォルダー名> でのファイル書き込みアクセス許可があるか確認します。<br/> 2. アプライアンスで指定された資格情報に必要なアクセス許可がない場合は、別の資格情報セットを指定するか、既存のものを編集します。 (考えられる原因で、Azure Migrate が試した資格情報のフレンドリ名を見つけてください) |
| **10010:** メタデータを収集するために必要なコマンド- %CommandName; がサーバー上で見つからないため、検出できません。 | コマンド %CommandName; を含むパッケージがサーバーにインストールされていません。 | コマンド %CommandName; を含むパッケージがサーバーにインストールされていることを確認してください。 |
| **10011:** アプライアンスで指定された資格情報が、対話型セッションのログインとログオフに使用されていました。 | 対話型ログインおよびログオフにより、使用されているアカウントのプロファイルのレジストリ キーが強制的にアンロードされます。この状況により、これらのキーを将来使用できなくなります。 | [こちら](/sharepoint/troubleshoot/administration/800703fa-illegal-operation-error#resolutionus/sharepoint/troubleshoot/administration/800703fa-illegal-operation-error)に記載されている解決方法を使用してください |
| **10012:** サーバーの資格情報が、アプライアンスで指定されませんでした。 | アプライアンスでサーバーの資格情報が指定されていないか、指定したドメイン資格情報のドメイン名が正しくありません。このエラーの原因の詳細については、[こちらを](troubleshoot-dependencies.md#error-10012-credentialnotprovided)ご覧ください。 | 1. アプライアンスでサーバーの資格情報が指定されていること、および資格情報を使用してサーバーにアクセスできることを確認してください。 <br/> 2. 複数のサーバー資格情報をアプライアンスで追加できるようになりました。アプライアンス構成マネージャーに戻り、サーバーの資格情報を指定します。|


## <a name="error-970-dependencymapinsufficientprivilegesexception"></a>エラー 970: DependencyMapInsufficientPrivilegesException

### <a name="cause"></a>原因
このエラーは通常、必要な権限を持つ資格情報をアプライアンスで指定していない場合に、Linux サーバーで発生します。

### <a name="remediation"></a>修復
- 次を指定したことを確認します: root ユーザー アカウント、または
- /bin/netstat および /bin/ls の各ファイルに対してこちらのアクセス許可を持つアカウント:
   - CAP_DAC_READ_SEARCH
   - CAP_SYS_PTRACE
- アプライアンスで指定されたユーザー アカウントに必要な権限があるかを調べるには、こちらの手順を実行します。
1. このエラーが発生したサーバーに、エラー メッセージに示されているのと同じユーザー アカウントでログインします。
2. 次のコマンドを Shell で実行します。 エージェントレスの依存関係分析に必要な権限を持っていない場合は、こちらのエラーが表示されます。

   ````
   ps -o pid,cmd | grep -v ]$
   netstat -atnp | awk '{print $4,$5,$7}'
   ````
3. 次のコマンドを実行して、/bin/netstat および /bin/ls の各ファイルに対して必要なアクセス許可を設定します。

   ````
   sudo setcap CAP_DAC_READ_SEARCH,CAP_SYS_PTRACE=ep /bin/ls
   sudo setcap CAP_DAC_READ_SEARCH,CAP_SYS_PTRACE=ep /bin/netstat
   ````
4. 上のコマンドの結果、必要なアクセス許可がユーザー アカウントに割り当てられたかどうかを検証できます。

   ````
   getcap /usr/bin/ls
   getcap /usr/bin/netstat
   ````
5. 手順 2 で指定したコマンドを再実行して、正常な出力を取得します。


## <a name="error-9014-httpgetrequesttoretrievefilefailed"></a>エラー 9014: HTTPGetRequestToRetrieveFileFailed

### <a name="cause"></a>原因
この問題が発生するのは、アプライアンスの VMware 検出エージェントが、依存関係データを格納した出力ファイルを、サーバー ファイル システムから、サーバーがホストされている ESXi ホストを経由してダウンロードしようとしたときです。

### <a name="remediation"></a>修復
- ESXi ホスト " _(名前はエラー メッセージに示されている)_ " に対する TCP 接続を、アプライアンスからポート 443 (依存関係データをプルするために ESXi ホストで開く必要がある) でテストするには、PowerShell をアプライアンス サーバーで開き、次のコマンドを実行します。
    ````
    Test -NetConnection -ComputeName <Ip address of the ESXi host> -Port 443
    ````
- コマンドから正常な接続が返された場合は、Azure Migrate プロジェクト > Discovery and assessment\(検出と評価\) > Overview\(概要\) >Manage\(管理\) > Appliances\(アプライアンス\) に移動し、アプライアンス名を選択して **サービスの更新** を選択します。

## <a name="error-9018-powershellnotfound"></a>エラー 9018: PowerShellNotFound

### <a name="cause"></a>原因
このエラーは通常、Windows Server 2008 以前を実行しているサーバーで発生します。

### <a name="remediation"></a>修復
必要な PowerShell バージョン (2.0 以降) をサーバーのこちらの場所にインストールする必要があります: ($SYSTEMROOT)\System32\WindowsPowershell\v1.0\powershell.exe PowerShell を Windows Server にインストールする方法の詳細については、[こちら](/powershell/scripting/windows-powershell/install/installing-windows-powershell)をご覧ください。

必要な PowerShell バージョンをインストールした後で、エラーが解決したかどうかを調べるには、[こちら](troubleshoot-dependencies.md#mitigation-verification-using-vmware-powercli)の手順に従ってください。

## <a name="error-9022-getwmiobjectaccessdenied"></a>エラー 9022: GetWMIObjectAccessDenied

### <a name="remediation"></a>修復
アプライアンスで指定されたユーザー アカウントが WMI 名前空間および副名前空間にアクセスできることを確認します。 アクセスを設定するには、次の手順に従ってください。
1.  このエラーを報告しているサーバーへ移動します。
2.  スタート メニューで [ファイル名を指定して実行] を検索して選択します。 [ファイル名を指定して実行] ダイアログ ボックスで、[名前] テキスト フィールドに「wmimgmt .msc」と入力し、Enter キーを押します。
3.  wmimgmt console コンソールが開き、[WMI コントロール (ローカル)] が左側のパネルに表示されます。 右クリックして、メニューから [プロパティ] を選択します。
4.  [WMI コントロール (ローカル) のプロパティ] ダイアログ ボックスで、[セキュリティ] タブを選択します。
5.  [セキュリティ] タブで、[セキュリティ] ボタンを選択すると、[セキュリティ Root] ダイアログ ボックスが開きます。
7.  [詳細設定] ボタンを選択して、[Root のセキュリティの詳細設定] ダイアログ ボックスを開きます。 
8.  [追加] ボタンを選択すると、[Root のアクセス許可エントリ] ダイアログ ボックスが開きます。
9.  [プリンシパルの選択] をクリックして、[ユーザー、コンピューター、サービス アカウントまたはグループの選択] ダイアログ ボックスを開きます。
10. WMI へのアクセス権を付与するユーザー名またはグループを選択して、[OK] をクリックします。
11. 実行アクセス許可を付与して、[適用先] ドロップダウンで [この名前空間と副名前空間] を選択します。
12. [適用] ボタンをクリックして設定を保存し、すべてのダイアログ ボックスを閉じます。

必要なアクセス権を取得した後で、エラーが解決したか調べるには、[こちら](troubleshoot-dependencies.md#mitigation-verification-using-vmware-powercli)の手順に従ってください。

## <a name="error-9032-invalidrequest"></a>エラー 9032: InvalidRequest

### <a name="cause"></a>原因
この問題には複数の理由が考えられます。理由の 1 つがアプライアンス構成マネージャーで指定されたユーザー名 (サーバーの資格情報) に無効な XML 文字が含まれていることです。これが原因で SOAP 要求の解析中にエラーが発生します。

### <a name="remediation"></a>修復
- サーバー資格情報のユーザー名に無効な XML 文字が含まれていないこと、および username@domain.com 形式 (UPN 形式としてよく知られている) であることを確認します。
- アプライアンスで資格情報を編集後、[こちら](troubleshoot-dependencies.md#mitigation-verification-using-vmware-powercli)の手順を実行すると、エラーが解決したかどうかを調べることができます。


## <a name="error-10002-scriptexecutiontimedoutonvm"></a>エラー 10002: ScriptExecutionTimedOutOnVm

### <a name="cause"></a>原因
- このエラーは、サーバーが遅いか応答しておらず、依存関係データをプルするために実行されたスクリプトがタイムアウトし始めると発生します。
- 検出エージェントにこのエラーがサーバーで発生すると、その後はアプライアンスがエージェントレスの依存関係分析をサーバーで試行しないので、応答しないサーバーが過負荷になるのを防ぎます。
- 従ってこのエラーは、サーバーの問題を調べて検出サービスを再開するまで、発生し続けます。

### <a name="remediation"></a>修復
1. このエラーが発生しているサーバーにログインします。
1. PowerShell で次のコマンドを実行します。
   ````
   Get-WMIObject win32_operatingsystem;
   Get-WindowsFeature  | Where-Object {$_.InstallState -eq 'Installed' -or ($_.InstallState -eq $null -and $_.Installed -eq 'True')};
   Get-WmiObject Win32_Process;
   netstat -ano -p tcp | select -Skip 4;
   ````
3. コマンドの結果が数秒で出力された場合は、Azure Migrate プロジェクト > [Discovery and assessment]\(検出と評価\) > [Overview]\(概要\) >[Manage]\(管理\) > [Appliances]\(アプライアンス\) に移動し、アプライアンス名を選択し、 **[サービスの更新]** を選択して検出サービスを再開します。
4. コマンドから出力が返されずにタイムアウトする場合は、 
- サーバー上の CPU またはメモリを大きく消費しているプロセスがどれかを見つけ出す必要があります。
- さらに多くのコア/メモリをそのサーバーに提供して、コマンドを再度実行します。

## <a name="error-10005-guestcredentialnotvalid"></a>エラー 10005: GuestCredentialNotValid

### <a name="remediation"></a>修復
- アプライアンス構成マネージャーで [資格情報の再検証] をクリックして、資格情報 _(エラーに表示されるフレンドリ名)_ が有効であることを確認します。
- アプライアンスで指定されているのと同じ資格情報を使用して、影響を受けるサーバーにログインできることを確認します。
- そのサーバーに対して、(サーバーがドメインに参加している場合は同じドメインの) 別のユーザー アカウントを、管理者アカウントの代わりに使用してみることができます。
- この問題は、グローバル カタログ <-> ドメイン コントローラーの通信が切断されているときに発生する可能性があります。 これを調べるには、ドメイン コントローラーで新しいユーザー アカウントを作成し、同じものをアプライアンスで指定します。 これにより、ドメイン コントローラーの再起動も必要になります。
- 修復手順を行なった後で、エラーが解決したかどうかを調べるには、[こちら](troubleshoot-dependencies.md#mitigation-verification-using-vmware-powercli)の手順に従ってください。

## <a name="error-10012-credentialnotprovided"></a>エラー 10012: CredentialNotProvided

### <a name="cause"></a>原因
このエラーは、ドメイン名が正しくないドメイン資格情報をアプライアンス構成マネージャーで指定したときに発生します。 たとえば、ユーザー名が user@abc.com のドメイン資格情報を指定したけれども ドメイン名を def.com と指定した場合、サーバーが def.com に接続されていると、これらの資格情報は試行されず、このエラー メッセージが表示されます。

### <a name="remediation"></a>修復
- アプライアンス構成マネージャーにアクセスしてサーバー資格情報を追加するか、または既存のものを、原因での説明に従って編集します。
- 修復手順を行なった後で、エラーが解決したかどうかを調べるには、[こちら](troubleshoot-dependencies.md#mitigation-verification-using-vmware-powercli)の手順に従ってください。

## <a name="mitigation-verification-using-vmware-powercli"></a>VMware PowerCLI を使用した軽減策の検証

上記のエラーの軽減手順を使用した後、アプライアンス サーバーからいくつかの PowerCLI コマンドを実行することにより、軽減策が機能しているかどうかを確認できます。 コマンドが成功した場合は、問題は解決したことを意味します。そうでない場合は、修復の手順を確認して、再度実行する必要があります。

1. 次のコマンドを実行して、PowerCLI をアプライアンス サーバーで設定します。
   ````
   Install-Module -Name VMware.PowerCLI -AllowClobber
   Set-PowerCLIConfiguration -InvalidCertificateAction Ignore
   ````
2. vCenter Server に接続します。そのためには、こちらのコマンドに vCenter Server の IP アドレスを、プロンプトに資格情報を入力します。
   ````
   Connect-VIServer -Server <IPAddress of vCenter Server>
   ````
3. サーバー名とサーバー資格情報を (アプライアンスで指定したように) 指定して、ターゲット サーバーにアプライアンスから接続します。
   ````
   $vm = get-VM <VMName>
   $credential = Get-Credential
   ````
4. エージェントレスの依存関係分析で、次のコマンドを実行して、出力が成功したことを確認します。

  - Windows サーバーの場合:

      ```` 
      Invoke-VMScript -VM $vm -ScriptText "powershell.exe 'Get-WmiObject Win32_Process'" -GuestCredential $credential 
  
      Invoke-VMScript -VM $vm -ScriptText "powershell.exe 'netstat -ano -p tcp'" -GuestCredential $credential 
      ```` 
   - Linux サーバーの場合:
      ````
      Invoke-VMScript -VM $vm -ScriptText "ps -o pid,cmd | grep -v ]$" -GuestCredential $credential

      Invoke-VMScript -VM $vm -ScriptText "netstat -atnp | awk '{print $4,$5,$7}'" -GuestCredential $credential
      ````
5. 軽減策が効いたことを確認した後で、Azure Migrate プロジェクト > [Discovery and assessment]\(検出と評価\) > [Overview]\(概要\) >[Manage]\(管理\) > [Appliances]\(アプライアンス\) に移動し、アプライアンス名を選択し、 **[サービスの更新]** を選択して検出サービスを再開します。


## <a name="my-log-analytics-workspace-is-not-listed-when-trying-to-configure-the-workspace-in-azure-migrate-for-agent-based-dependency-analysis"></a>Azure Migrate でワークスペースをエージェントベースの依存関係分析のために構成しようとしたときに自分の Log Analytics ワークスペースが一覧にない
現在、Azure Migrate では、米国東部、東南アジア、および西ヨーロッパの各リージョンで OMS ワークスペースの作成がサポートされています。 ワークスペースが Azure Migrate 以外の他のリージョンで作成されている場合、現在、プロジェクトに関連付けることはできません。

## <a name="agent-based-dependency-visualization-in-azure-government"></a>Azure Government でのエージェントベースの依存関係の視覚化

エージェントベースの依存関係の分析は、Azure Government ではサポートされません。 エージェントレスの依存関係分析を使用してください _(VMware サーバーでのみ使用可能)_ 。

## <a name="agent-based-dependencies-dont-show-after-agent-install"></a>エージェントベースの依存関係がエージェント インストール後に表示されない

オンプレミスの VM に依存関係視覚化エージェントをインストールした後、Azure Migrate ポータルで依存関係が表示されるまで 15 分から 30 分かかります。 30 分以上待っている場合は、Microsoft Monitoring Agent (MMA) が Log Analytics ワークスペースに接続できることを確認してください。

Windows VM の場合:
1. コントロール パネルで MMA を開始します。
2. **[Microsoft Monitoring Agent のプロパティ]**  >  **[Azure Log Analytics (OMS)]** で、ワークスペースの **[状態]** が緑色になっていることを確認します。
3. 状態が緑色でない場合は、ワークスペースを削除して、再度 MMA に追加してみてください。

    ![MMA のステータス](./media/troubleshoot-assessment/mma-properties.png)

Linux VM の場合、MMA と依存関係エージェントのインストールに関するすべてのコマンドが正常に実行されたことを確認します。 詳細については、[こちら](../azure-monitor/vm/service-map.md#post-installation-issues)のトラブルシューティング ガイドを参照してください。

## <a name="supported-operating-systems-for-agent-based-dependency-analysis"></a>エージェントベースの依存関係分析でサポートされているオペレーティング システム

- **MMS エージェント**:サポートされている [Windows](../azure-monitor/agents/agents-overview.md#supported-operating-systems) オペレーティング システムと [Linux](../azure-monitor/agents/agents-overview.md#supported-operating-systems) オペレーティング システムを確認します。
- **依存関係エージェント**: サポートされている [Windows および Linux](../azure-monitor/vm/vminsights-enable-overview.md#supported-operating-systems) オペレーティング システムを確認します。

## <a name="visualize-dependencies-for--1-hour-with-agent-based-dependency-analysis"></a>エージェントベースの依存関係分析を使用して 1 時間未満分の依存関係を視覚化する

エージェント ベースの依存関係の分析では、Azure Migrate を使用すると、過去 1 か月間の特定の日付に戻ることができますが、依存関係を視覚化できる期間は最大 1 時間です。 たとえば、依存関係マップにある期間機能を使用して、昨日の依存関係を表示することが可能ですが、1 時間の期間のみ表示できます。 ただし、Azure Monitor ログを使用すれば、長期間にわたって[依存関係データのクエリ](./how-to-create-group-machine-dependencies.md)を実行できます。

## <a name="visualized-dependencies-for--10-servers-with-agent-based-dependency-analysis"></a>エージェントベースの依存関係分析を使用して 10 台未満のサーバーの依存関係を視覚化する

Azure Migrate では、エージェント ベースの依存関係の分析を使用すると、最大 10 個の VM を含む[グループの依存関係を視覚化](./how-to-create-a-group.md#refine-a-group-with-dependency-mapping)できます。 大きいグループの場合、依存関係を視覚化するには VM を小さいグループに分割することをお勧めします。

## <a name="servers-show-install-agent-for-agent-based-dependency-analysis"></a>エージェントベースの依存関係分析でサーバーに "エージェントのインストール" が表示される

依存関係の視覚化が有効になっているサーバーを Azure に移行した後、サーバーでは、次の動作により、"依存関係の表示" ではなく "エージェントのインストール" アクションが表示される場合があります。

- Azure に移行した後、オンプレミスのサーバーはオフになり、同等の VM が Azure で起動されます。 これらのサーバーは、別々の MAC アドレスを取得します。
- ユーザーがオンプレミスの IP アドレスを保持するかどうかにより、サーバーは異なる IP アドレスも取得する場合があります。
- MAC と IP アドレスの両方がオンプレミスと異なる場合、Azure Migrate ではオンプレミスのサーバーと Service Map 依存関係データの関連付けは行われません。 この場合、依存関係の表示ではなく、エージェントをインストールするオプションが表示されます。
- Azure へのテスト移行の後、オンプレミスのサーバーは想定どおりにオンの状態が維持されます。 Azure にスピン アップされる同等のサーバーでは、異なる MAC アドレスが取得され、異なる IP アドレスが取得されることがあります。 これらのサーバーから送信される Azure Monitor ログ トラフィックをブロックしない限り、Azure Migrate ではオンプレミスのサーバーと Service Map 依存関係データの関連付けは行われず、依存関係が表示されるのではなく、エージェントをインストールするオプションが表示されます。

## <a name="capture-network-traffic"></a>ネットワーク トラフィックをキャプチャする

次のようにネットワーク トラフィック ログを収集します。

1. [Azure portal](https://portal.azure.com) にサインインします。
2. F12 キーを押して開発者ツールを起動します。 必要な場合は、 **[ナビゲーション時にエントリをクリア]** の設定をオフにします。
3. **[ネットワーク]** タブを選択し、ネットワーク トラフィックのキャプチャを開始します。
   - Chrome では、 **[Preserve log]\(ログの保持\)** を選択します。 自動で記録が開始されるはずです。 赤い円は、トラフィックがキャプチャされていることを示しています。 赤い円が表示されない場合は、黒い円を選択して開始します。
   - Microsoft Edge または Internet Explorer では、自動で記録が開始されるはずです。 開始されない場合は、緑色の再生ボタンを選択します。
4. エラーを再現してみます。
5. 記録中にエラーが発生したら、記録を停止し、記録されたアクティビティのコピーを保存します。
   - Chrome では、右クリックして **[Save as HAR with content]\(内容を HAR ファイルに保存する\)** を選択します。 この操作により、ログが圧縮されて HTTP Archive (har) ファイルとしてエクスポートされます。
   - Microsoft Edge または Internet Explorer で、 **[キャプチャしたトラフィックのエクスポート]** オプションを選択します。 この操作により、ログが圧縮されてエクスポートされます。
6. **[コンソール]** タブを選択し、いずれかの警告またはエラーを確認します。 コンソール ログを保存するには次の操作を行います。
   - Chrome では、コンソール ログのどこかを右クリックします。 **[名前を付けて保存]** を選択し、ログをエクスポートして zip 圧縮します。
   - Microsoft Edge または Internet Explorer では、エラーを右クリックして **[すべてコピー]** を選択します。
7. 開発者ツールを閉じます。


## <a name="next-steps"></a>次のステップ

評価を[作成](how-to-create-assessment.md)するか[カスタマイズ](how-to-modify-assessment.md)します。