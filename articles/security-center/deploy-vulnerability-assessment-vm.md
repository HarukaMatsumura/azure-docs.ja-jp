---
title: Azure 仮想マシンに対する Security Center の統合脆弱性評価
description: Azure Virtual Machines で脆弱性評価ソリューションをインストールすると、Azure Security Center では、仮想マシンの保護に役立つ推奨事項が表示されます。
services: security-center
documentationcenter: na
author: memildin
manager: rkarlin
ms.service: security-center
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/22/2020
ms.author: memildin
ms.openlocfilehash: b96c9a7693b6d0d791bb97e6fb611a84a2f1f94b
ms.sourcegitcommit: 5abc3919a6b99547f8077ce86a168524b2aca350
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/07/2020
ms.locfileid: "91812618"
---
# <a name="azure-defenders-integrated-vulnerability-assessment-solution-for-azure-virtual-machines"></a>Azure 仮想マシンに対する Azure Defender の統合された脆弱性評価ソリューション

すべてのサイバーリスクとセキュリティプログラムの中核となるコンポーネントは、脆弱性の特定と分析です。 

Security Center によって脆弱性評価ソリューションがデプロイされていない VM が接続されていることが検出されると、次のセキュリティに関する推奨事項が表示されます。

**脆弱性評価ソリューションを仮想マシンで有効にする必要がある**

ニーズと予算を最も満たした脆弱性評価ソリューションをデプロイするには、この推奨事項を使用します。

- **統合された脆弱性評価 (Qualys を利用)** - Azure Defender には、追加費用なしで仮想マシン脆弱性スキャンをする機能が含まれます。 Qualys ライセンスも Qualys アカウントも必要ありません。すべてが Security Center 内でシームレスに処理されます。 このページでは、このスキャナーの詳細とデプロイする手順について説明します。

- **ライセンス持ち込み (BYOL) ソリューション** - Security Center では他のベンダーからのツールの統合がサポートされていますが、ライセンスのコスト、デプロイ、および構成について対処する必要があります。 Security Center でツールをデプロイすると、ツールが不足しているコンピューターに関する情報が取得されます。 また、Security Center 内で結果を表示することもできます。 Azure Defender で含まれている Qualys ライセンスではなく、組織のプライベート Qualys または Rapid7 ライセンスを使用する場合は、[BYOL ソリューションをデプロイする方法](deploy-vulnerability-assessment-byol-vm.md)に関するページを参照してください。


## <a name="availability"></a>可用性

|側面|詳細|
|----|:----|
|リリース状態:|一般提供 (GA)|
|価格:|[Azure Defender for servers](defender-for-servers-introduction.md) が必要|
|必要なロールとアクセス許可:|**リソース所有者**は、スキャナーをデプロイできます<br>**セキュリティ閲覧者**は、結果を表示できます|
|クラウド:|![Yes](./media/icons/yes-icon.png) 商用クラウド<br>![No](./media/icons/no-icon.png) ナショナル/ソブリン (US Gov、China Gov、その他の Gov)|
|||

## <a name="overview-of-the-integrated-vulnerability-scanner"></a>統合された脆弱性スキャナーの概要

Azure Security Center に含まれている脆弱性スキャナーは、Qualys を利用しています。 Qualys のスキャナーは、Azure Virtual Machines の脆弱性をリアルタイムで識別するための主要なツールの 1 つです。 [Azure Defender for servers](defender-for-servers-introduction.md) でのみ使用できます。 Qualys ライセンスも Qualys アカウントも必要ありません。すべてが Security Center 内でシームレスに処理されます。

### <a name="how-the-integrated-vulnerability-scanner-works"></a>統合された脆弱性スキャナーの動作

脆弱性スキャナー拡張機能は、次のように機能します。

1. **デプロイ** - Azure Security Center でマシンが監視され、選択した仮想マシンに Qualys 拡張機能をデプロイするための推奨事項が表示されます。

1. **情報収集** - 拡張機能により成果物が収集され、定義されたリージョンの Qualys クラウド サービスでの分析用に送信されます。

1. **分析** - Qualys のクラウド サービスにより脆弱性評価が実施され、その結果が Security Center に送信されます。 

    > [!IMPORTANT]
    > Microsoft は、お客様のプライバシー、機密性、セキュリティを確保するために、お客様の詳細情報を Qualys と共有しません。 [Azure に組み込まれているプライバシー基準の詳細については、こちらを参照してください](https://www.microsoft.com/trust-center/privacy)。

1. **レポート** - 結果は Security Center で確認できます。

[![Azure Security Center の組み込みの脆弱性スキャナーのプロセス フロー図](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png)](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png#lightbox)


## <a name="deploy-the-integrated-vulnerability-scanner-to-your-vms"></a>統合された脆弱性スキャナーを VM にデプロイする

1. [Azure portal](https://azure.microsoft.com/features/azure-portal/) から **Security Center** を開きます。

1. Azure Security Center メニューから、 **[推奨事項]** ページを開きます。

1. **[脆弱性評価ソリューションを仮想マシンで有効にする必要]** 推奨事項を選択します。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="[推奨事項] ページ内のマシンのグループ" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png":::

    VM は、次の 1 つ以上のグループに表示されます。

    * **正常なリソース** - Security Center で、これらの VM で実行されている脆弱性評価ソリューションが検出されました。
    * **異常なリソース** - これらの VM に脆弱性スキャナー拡張機能をデプロイできます。 
    * **適用できないリソース** - これらの VM では、脆弱性スキャナー拡張機能をデプロイできません。 このタブに VM が表示される理由は、AKS クラスター内のイメージであるか、仮想マシン スケール セットの一部であるか、統合された脆弱性スキャナーでサポートされているオペレーティング システムのいずれかが実行されていないためです。

        | **ベンダー名** | **OS** | **サポートされているバージョン** |
        |----|----|----|
        |Microsoft|Windows|All|
        |Red Hat|Enterprise Linux|5.4+、6、7.0-7.8、8.0-8.1|
        |Red Hat|CentOS|5.4+、6、7.0-7.7、8.0-8.1|
        |Red Hat|Fedora|22-31|
        |SUSE|Linux Enterprise Server (SLES)|11、12、15|
        |SUSE|OpenSUSE|12、13、15.0-15.2|
        |SUSE|Leap|42.1|
        |Oracle|Enterprise Linux|5.11、6、7.0-7.5|
        |Debian|Debian|7.x-10.x|
        |Ubuntu|Ubuntu|12.04 LTS、14.04 LTS、15.x、16.04 LTS、18.04 LTS、19.10、20.04 LTS|

1. 異常なマシンの一覧から、脆弱性評価ソリューションを受信するマシンを選択し、 **[修復]** を選択ます。

    >[!IMPORTANT]
    > 構成によって、この一覧の表示が異なる場合があります。 
    >
    > - サードパーティ製の脆弱性スキャナーが構成されていない場合は、デプロイすることができません。
    > - 選択した VM が Azure Defender で保護されていない場合、ASC の統合された脆弱性スキャナー オプションは使用できません。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options.png" alt-text="[推奨事項] ページ内のマシンのグループ":::

1. 推奨されるオプションを選択し、**ASC の統合された脆弱性スキャナーをデプロイして**、**続行します**。

1. さらに確認が求められます。 **[修復]** を選択します。

    スキャナー拡張機能が、選択したすべての VM に数分以内にインストールされます。
    
    拡張機能が正常にデプロイされるとすぐに、スキャンが自動的に開始されます。 スキャンはその後、4 時間間隔で実行されます。 この間隔は構成できません。

    >[!IMPORTANT]
    > 1 つ以上の VM でデプロイが失敗した場合は、ターゲット VM が次の 2 つの IP アドレスで Qualys のクラウド サービスと通信できることを確認します (ポート 443 経由 - HTTPS の規定値)。
    >
    >   - 64.39.104.113 - Qualys の米国のデータ センター
    >   - 154.59.121.74 - Qualys の欧州のデータ センター
    >
    > VM が欧州の Azure リージョンにある場合、その成果物は Qualys の欧州のデータ センターで処理されます。 他の場所にある仮想マシンの成果物は、米国のデータ センターに送信されます。 


## <a name="automate-at-scale-deployments"></a>大規模なデプロイを自動化する

> [!NOTE]
> このセクションで説明されているすべてのツールは、[Security Center の GitHub コミュニティ リポジトリ](https://github.com/Azure/Azure-Security-Center/blob/master/README.md)から入手できます。 ここでは、ASC デプロイ全体で使用するスクリプト、自動化、その他の有用なリソースを見つけることができます。
>
> これらのツールの一部は、大規模なデプロイで有効にした後に接続された新しいマシンにのみ影響します。 それ以外は、既存のマシンにもデプロイされます。 複数のアプローチを組み合わせることができます。

統合スキャナーの大規模なデプロイを自動化するには、いくつかの方法があります。

- **[Azure Resource Manager]** – この方法は、Azure portal の **[推奨ロジックの表示]** から使用できます。 修復スクリプトには、自動化に使用できる関連の ARM テンプレートが含まれています。:::image type="content" source="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png" alt-text="[推奨事項] ページ内のマシンのグループ" lightbox="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png":::
- **DeployIfNotExists ポリシー** – 新しく作成されたすべてのマシンでスキャナーを受信できるようにするための[カスタム ポリシー](https://github.com/Azure/Azure-Security-Center/tree/master/Remediation%20scripts/Enable%20the%20built-in%20vulnerability%20assessment%20solution%20on%20virtual%20machines%20(powered%20by%20Qualys)/Azure%20Policy)です。 **[Azure へのデプロイ]** を選択し、関連するパラメーターを設定します。 このポリシーは、リソース グループ、サブスクリプション、または管理グループのレベルで割り当てることができます。
- **PowerShell スクリプト** – ```Update qualys-remediate-unhealthy-vms.ps1``` スクリプトを使用して、すべての異常な仮想マシンの拡張機能をデプロイします。 新しいリソース上にインストールするには、[Azure Automation](https://docs.microsoft.com/azure/automation/automation-intro) でスクリプトを自動化します。 このスクリプトは、推奨事項によって検出されたすべての異常なマシンを検索し、Azure Resource Manager の呼び出しを実行します。
- **Azure Logic Apps** – [サンプル アプリ](https://github.com/Azure/Azure-Security-Center/tree/master/Workflow%20automation/Install-VulnAssesmentAgent)に基づいてロジック アプリを構築します。 Security Center の [ワークフロー自動化](workflow-automation.md)ツールを使用してロジック アプリをトリガーし、**仮想マシンで脆弱性評価ソリューションを有効にする必要がある場合** に、常にリソースに対して推奨事項が生成されるようにスキャナーがデプロイされます。
- **REST API** – Security Center の REST API を使用して統合された脆弱性評価ソリューションをデプロイするには、次の URL の PUT 要求を行い、関連するリソース ID を追加します。```https://management.azure.com/<resourceId>/providers/Microsoft.Security/serverVulnerabilityAssessments/default?api-Version=2015-06-01-preview```



## <a name="trigger-an-on-demand-scan"></a>オンデマンド スキャンをトリガーする

ローカルまたはリモートで実行されたスクリプトまたは GPO を使用して、VM 自体からオンデマンド スキャンをトリガーできます。 また、パッチのデプロイ ジョブの最後に、ソフトウェア配布ツールにこれを統合することもできます。 

次のコマンドを実行すると、オンデマンド スキャンがトリガーされます。

- **Windows VM**: ```REG ADD HKLM\SOFTWARE\Qualys\QualysAgent\ScanOnDemand\Vulnerability /v "ScanOnDemand" /t REG_DWORD /d "1" /f```
- **Linux VM**: ```sudo /usr/local/qualys/cloud-agent/bin/cloudagentctl.sh action=demand type=vm```

## <a name="faq---integrated-vulnerability-scanner-powered-by-qualys"></a>FAQ -統合された脆弱性スキャナー (Qualys を利用)

### <a name="are-there-any-additional-charges-for-the-qualys-license"></a>Qualys ライセンスに対して追加料金は発生しますか?
いいえ。 すべての Azure Defender ユーザーが、組み込みスキャナーを無料でご利用いただけます。 この推奨事項では、スキャナーがライセンスと構成情報と共にデプロイされます。 追加のライセンスは必要ありません。 

### <a name="what-prerequisites-and-permissions-are-required-to-install-the-qualys-extension"></a>Qualys 拡張機能をインストールするために必要な前提条件とアクセス許可は何ですか。
拡張機能をデプロイするすべての VM に対する書き込みアクセス許可が必要です。

Azure Security Center 脆弱性評価拡張機能 (Qualys を利用) は、他の拡張機能と同様に、Azure 仮想マシン エージェント上で実行されます。 つまり、Windows ではローカル ホストとして、Linux では Root として実行されます。

セットアップ時に、VM が次の 2 つの Qualys のデータ センターと通信できることが確認されます (ポート 443 経由 - HTTPS の既定値)。

- 64.39.104.113 - Qualys の米国のデータ センター
- 154.59.121.74 - Qualys の欧州のデータ センター

現在、この拡張機能ではプロキシ構成の詳細が受け入れられません。

### <a name="can-i-remove-the-security-center-qualys-extension"></a>Security Center の Qualys 拡張機能を削除できますか? 
VM から拡張機能を削除する場合は、手動で、または任意のプログラム ツールを使用して実行できます。 

次の詳細情報が必要になります。

* Linux では、拡張機能は "LinuxAgent.AzureSecurityCenter" と呼ばれ、パブリッシャー名は "Qualys" です
* Windows では、拡張機能は "WindowsAgent.AzureSecurityCenter" と呼ばれ、プロバイダー名は "Qualys" です

### <a name="how-does-the-extension-get-updated"></a>拡張機能の更新はどのように行われますか?
Azure Security Center エージェント自体およびその他すべての Azure 拡張機能と同様に、Qualys スキャナーのマイナー更新はバックグラウンドで自動的に行われる場合があります。 すべてのエージェントと拡張機能は、自動的にデプロイされる前に広範囲にわたってテストされます。

### <a name="why-does-my-vm-show-as-not-applicable-in-the-recommendation"></a>推奨事項で VM が「適用できません」と表示されるのはなぜですか？
推奨事項の詳細ページでは、正常、異常、適用不可のリストのうち 1 つ以上で VM がグループ化されます。

適用できないリソース グループに VM がある場合は、Security Center がその VM に脆弱性スキャナー拡張機能をデプロイできないことを意味します。 

次の理由により、VM がこのタブに表示される場合があります。

- Azure Defender によって保護されていません。前述のように、Azure Security Center に含まれる脆弱性スキャナーは、[Azure Defender for servers](defender-for-servers-introduction.md) によって保護されているマシンでのみ使用できます。

- AKS クラスター内のイメージであるか、仮想マシン スケール セットの一部である。この拡張機能は、PaaS リソースである VM をサポートしていません。

- サポートされているオペレーティング システムのいずれかが実行されていない。

    | **ベンダー名** | **OS** | **サポートされているバージョン** |
    |----|----|----|
    |Microsoft|Windows|All|
    |Red Hat|Enterprise Linux|5.4+、6、7.0-7.8、8.0-8.1|
    |Red Hat|CentOS|5.4+、6、7.0-7.7、8.0-8.1|
    |Red Hat|Fedora|22-31|
    |SUSE|Linux Enterprise Server (SLES)|11、12、15|
    |SUSE|OpenSUSE|12、13、15.0-15.2|
    |SUSE|Leap|42.1|
    |Oracle|Enterprise Linux|5.11、6、7.0-7.5|
    |Debian|Debian|7.x-10.x|
    |Ubuntu|Ubuntu|12.04 LTS、14.04 LTS、15.x、16.04 LTS、18.04 LTS、19.10、20.04 LTS|
    ||||

### <a name="what-is-scanned-by-the-built-in-vulnerability-scanner"></a>組み込みの脆弱性スキャナーでは何がスキャンされますか?
スキャナーは仮想マシンで実行されており、その VM 自体の脆弱性を探します。 仮想マシンからネットワークをスキャンすることはできません。

### <a name="does-the-scanner-integrate-with-my-existing-qualys-console"></a>スキャナーは既存の Qualys コンソールと統合されますか?
Security Center 拡張機能は、既存の Qualys スキャナーとは別のツールです。 ライセンス制限は、Azure Security Center 内でのみ使用できることを意味します。

### <a name="microsoft-defender-advanced-threat-protection-also-includes-threat--vulnerability-management-tvm-how-is-the-security-center-vulnerability-assessment-extension-different"></a>Microsoft Defender Advanced Threat Protection にも、脅威および脆弱性管理 (TVM) が含まれています。 Security Center 脆弱性評価拡張機能はどのように異なりますか?
Microsoft では、Windows に組み込まれている Microsoft Defender ATP の脅威および脆弱性管理ソリューションを使用して、世界クラスの脆弱性管理サービスを積極的に開発しています。

現在、Azure Security Center の脆弱性評価拡張機能では Qualys を利用しています。 Qualys の拡張機能により、Windows と Linux 両方の VM が確実にサポートされます。 また、この拡張機能は、まだ CVE を持たない脆弱性に関する Qualys 独自の知識の恩恵も得ることができます。

### <a name="how-quickly-will-the-scanner-identify-newly-disclosed-critical-vulnerabilities"></a>新たに公開された重大な脆弱性はどのくらい迅速に特定されますか?
Qualys では、重大な脆弱性が公開されてから 48 時間以内に、その情報を処理に組み込み、影響を受ける VM を特定できます。



## <a name="next-steps"></a>次のステップ


> [!div class="nextstepaction"]
> [脆弱性評価ソリューションの結果を修復する](remediate-vulnerability-findings-vm.md)


Security Center では、次の脆弱性分析も提供しています：

- SQL データベース - 「[脆弱性評価ダッシュボードで脆弱性評価レポートの探索をする](defender-for-sql-usage.md#explore-vulnerability-assessment-reports) 」を参照する
- Azure Container Registry イメージ - 「[コンテナー レジストリ用の Azure Defender を使用してイメージの脆弱性をスキャンする](defender-for-container-registries-usage.md)」をご覧ください
