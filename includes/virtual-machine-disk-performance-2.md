---
title: インクルード ファイル
description: インクルード ファイル
services: virtual-machines
author: albecker1
ms.service: virtual-machines
ms.topic: include
ms.date: 07/07/2020
ms.author: albecker1
ms.custom: include file
ms.openlocfilehash: 65f6c239f34775efff6a2ea2e399064a7702606a
ms.sourcegitcommit: f8d2ae6f91be1ab0bc91ee45c379811905185d07
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/10/2020
ms.locfileid: "89663366"
---
![Dsv3 ドキュメント](media/vm-disk-performance/dsv3-documentation.jpg)

**キャッシュされない**ディスクの最大スループットは、仮想マシンが処理できる既定のストレージの上限になります。 **キャッシュされる**ストレージのスループットの上限は、ホストキャッシュを有効にすると、別個の制限になります。 ホスト キャッシュの有効化は、仮想マシンを作成してディスクを接続するときに実行できます。 また、既存の VM 上のディスクに対するホスト キャッシュをオンまたはオフにするように調整することもできます。

![ホスト キャッシュ](media/vm-disk-performance/host-caching.jpg)

各ディスクのワークロードの要件に合うようにホスト キャッシュを調整できます。 読み取り操作のみが行われるワークロードでは読み取り専用になるように、読み取り操作と書き込み操作が同程度行われるワークロードでは読み取り/書き込みになるように、ホスト キャッシュを設定できます。 ワークロードがこれらのパターンのいずれにも該当しない場合は、残念ながらホスト キャッシュを使用することはできません。 

Standard_D8s_v3 仮想マシンの例で説明を続けましょう。 今回以外は、ディスクでホスト キャッシュを有効にし、現在 VM の IOPS 制限は 16,000 IOPS になっています。 VM に接続されているのは、5,000 IOPS を処理できる 3 台の下部 P30 ディスクです。

設定: 
- Standard_D8s_v3 
    - キャッシュされる IOPS:16,000
    - キャッシュされない IOPS:12,800
- P30 OS ディスク 
    - IOPS:5,000
    - ホスト キャッシュ有効 
- 2 台の P30 データ ディスク
    - IOPS:5,000
    - ホスト キャッシュ有効

![ホスト キャッシュの例](media/vm-disk-performance/host-caching-example-without-remote.jpg)

ここで、このキャッシュが有効になっている Standard_D8s_v3 仮想マシンを使用するアプリケーションで、15,000 IOPS の要求を行ったとします。 この要求は、接続されている下部ディスクごとの 5,000 IOPS として分解され、パフォーマンスの上限が発生することはありません。

## <a name="combined-uncached-and-cached-limits"></a>未キャッシュ制限とキャッシュ制限の組み合わせ

仮想マシンのキャッシュ制限と未キャッシュ制限は切り離されています。 これは、仮想マシンでキャッシュ制限に未キャッシュ制限を加えた合計ストレージ IO を取得できるように、VM に接続されているディスクでホスト キャッシュを有効にすると同時に他のディスクでホスト キャッシュを有効にしないことが可能であることを意味します。 これらの制限がどのように連携するかを例を用いて説明しましょう。Premium ディスクが接続された Standard_D8s_v3 仮想マシンの構成で説明を続けます。

設定: 
- Standard_D8s_v3 
    - キャッシュされる IOPS:16,000
    - キャッシュされない IOPS:12,800
- P30 OS ディスク 
    - IOPS:5,000
    - ホスト キャッシュ有効 
- 2 台の P30 データ ディスク
    - IOPS:5,000
    - ホスト キャッシュ有効
- 2 台の P30 データ ディスク
    - IOPS:5,000
    - ホスト キャッシュ無効

![リモート ストレージを使用するホスト キャッシュの例](media/vm-disk-performance/host-caching-example-with-remote.jpg)

Standard_D8s_v3 仮想マシンで実行されているアプリケーションで、25,000 IOPS の要求を行ったとします。 この要求は、接続されている下位ディスクごとの 5,000 IOPS として分解されますが、これらのディスクのうち 3 台でホスト キャッシュが使用され、2 台のディスクで使用されていません。 ホスト キャッシュを使用している 3 台ではキャッシュ制限である 16,000 の範囲内にあるため、これらの要求は正常に完了し、ストレージ パフォーマンスの上限が発生することはありません。 同様に、ホスト キャッシュを使用していない 2 台のディスクでは、未キャッシュ制限である 12,800 の範囲内にあるため、これらの要求も正常に完了し、上限が発生することはありません。

## <a name="metrics-for-disk-performance"></a>ディスクのパフォーマンスのメトリック
Azure には、仮想マシンとディスクのパフォーマンスに関する分析情報を提供するメトリックが用意されています。 これらのメトリックは、Azure portal を通じて視覚的に表示することも、API 呼び出しを通じて取得することもできます。 メトリックは 1 分間隔で計算されます。 次のメトリックを使用して、VM、ディスク IO、およびスループットのパフォーマンスに関する分析情報を取得できます。
- **OS ディスクのキューの深さ** – OS ディスクに対する読み取りまたは書き込みのために待機している現在の未処理 IO 要求の数。
- **OS ディスク読み取りバイト数/秒** – OS ディスクから 1 秒間に読み取られるバイトの数。
- **OS ディスク読み取り操作数/秒** – OS ディスクから 1 秒間に読み取られる入力操作の数。
- **OS ディスク書き込みバイト数/秒** – OS ディスクから 1 秒間に書き込まれるバイトの数。
- **OS ディスク書き込み操作数/秒** – OS ディスクから 1 秒間に書き込まれる出力操作の数。
- **データ ディスクのキューの深さ** – データ ディスクに対する読み取りまたは書き込みのために待機している現在の未処理 IO 要求の数。
- **データ ディスク読み取りバイト数/秒** – データ ディスクから 1 秒間に読み取られるバイトの数。
- **データ ディスク読み取り操作数/秒** – データ ディスクから 1 秒間に読み取られる入力操作の数。
- **データ ディスク書き込みバイト数/秒** – データ ディスクから 1 秒間に書き込まれるバイトの数。
- **データ ディスク書き込み操作数/秒** – データ ディスクから 1 秒間に書き込まれる入力操作の数。
- **ディスク読み取りバイト数/秒** – VM に接続されているすべてのディスクから 1 秒間に読み取られるバイトの合計数。
- **ディスク読み取り操作数/秒** – VM に接続されているすべてのディスクから 1 秒間に読み取られる入力操作の数。
- **ディスク書き込みバイト数/秒** – VM に接続されているすべてのディスクから 1 秒間に書き込まれるバイトの数。
- **ディスク書き込み操作数/秒** – VM に接続されているすべてのディスクから 1 秒間に書き込まれる出力操作の数。

## <a name="storage-io-utilization-metrics"></a>ストレージ IO 使用率メトリック
ディスク IO の上限の診断に役立つメトリック:
- **データ ディスク IOPS の消費率** - プロビジョニングされたデータ ディスク IOP に対する完了済みのデータ ディスク IOP で計算された割合。 この量が 100% の場合、実行しているアプリケーションで、データ ディスクの IOPS 制限からの IO 上限が発生します。
- **データ ディスク帯域幅の消費率** - プロビジョニングされたデータ ディスクのスループットに対する完了済みのデータ ディスクのスループットで計算された割合。 この量が 100% の場合、実行しているアプリケーションで、データ ディスクの帯域幅制限からの IO 上限が発生します。
- **OS ディスク IOPS の消費率** - プロビジョニングされた OS ディスクの IOP に対する完了済みの OS ディスクの IOP で計算された割合。 この量が 100% である場合、実行しているアプリケーションで、OS ディスクの IOPS 制限からの IO 上限が発生します。
- **OS ディスク帯域幅の消費率** - プロビジョニングされた OS ディスクのスループットに対する完了済みの OS ディスクのスループットで計算された割合。 この量が 100% である場合、実行しているアプリケーションで、OS ディスクの帯域幅制限からの IO 上限が発生します。