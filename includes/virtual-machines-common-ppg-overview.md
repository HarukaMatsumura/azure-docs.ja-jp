---
title: インクルード ファイル
description: インクルード ファイル
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 10/30/2019
ms.author: zivr
ms.custom: include file
ms.openlocfilehash: c7e3c9292b53aeb073e11a5293459e39a22ca81d
ms.sourcegitcommit: c52e50ea04dfb8d4da0e18735477b80cafccc2cf
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/08/2020
ms.locfileid: "89570161"
---
VM を単一リージョンに配置すると、インスタンス間の物理的な距離が短縮されます。 また、単一可用性ゾーンに配置した場合も、それらの物理的な位置は近くなります。 ただし、Azure の占有領域が拡大するにつれ、単一可用性ゾーンが複数の物理的なデータ センターにまたがる可能性があるため、ネットワーク待ち時間がアプリケーションに影響を与えることがあります。 

各 VM をできるだけ近くに配置して、可能性のある最も短い待ち時間を実現するには、それらを近接通信配置グループ内にデプロイするようにしてください。

近接通信配置グループは、Azure コンピューティング リソースが互いに物理的に近くに配置されるようにするために使用される論理的なグループ化です。 近接通信配置グループは、短い待ち時間が要件であるワークロードに役立ちます。


- スタンドアロン VM 間の短い待ち時間。
- 1 つの可用性セットまたは仮想マシン スケール セット内の VM 間の短い待ち時間。 
- スタンドアロン VM、複数の可用性セット内の VM、または複数のスケール セット内の VM の間の短い待ち時間。 1 つの配置グループ内に複数のコンピューティング リソースを配置して多層アプリケーションを構成できます。 
- 異なるハードウェアの種類を使用した複数のアプリケーション層間の短い待ち時間。 たとえば、1 つの近接通信配置グループ内での、可用性セット内の M シリーズを使用したバックエンドとスケール セット内の D シリーズ インスタンス上のフロント エンドの実行。


![近接通信配置グループのグラフィック](./media/virtual-machines-common-ppg/ppg.png)

## <a name="using-proximity-placement-groups"></a>近接通信配置グループの使用 

近接通信配置グループは、Azure における新しいタイプのリソースです。 他のリソースに対して使用するためには、あらかじめ作成しておく必要があります。 作成後、仮想マシンや可用性セット、仮想マシン スケール セットと組み合わせて使用することができます。 近接通信配置グループは、コンピューティング リソースを作成するときに、近接通信配置グループ ID を設定することで指定します。 

既存のリソースを近接通信配置グループに移動することもできます。 近接配置グループにリソースを移動するときは、まずアセットを停止 (割り当てを解除) する必要があります。コロケーション制約を満たすために、リージョン内の別のデータ センターに再デプロイされる可能性があるためです。 

可用性セットと仮想マシン スケール セットの場合は、個々の仮想マシンではなくリソース レベルで近接通信配置グループを設定する必要があります。 

近接通信配置グループは、固定のためのメカニズムではなくコロケーションの制約です。 特定のデータ センターを使用する最初のリソースのデプロイと共に、そのデータ センターに固定されます。 近接通信配置グループを使用するリソースをすべて停止 (割り当て解除) または削除すると、固定は解除されます。 そのため、複数の VM シリーズを含んだ近接通信配置グループを使用するときは、可能な限り、必要なすべてのタイプをテンプレートであらかじめ指定するか、デプロイが成功する可能性が高くなるようなデプロイ シーケンスに従うことが大切です。 デプロイに失敗した場合は、失敗した VM サイズをデプロイする最初のサイズとしてデプロイを再開します。

## <a name="what-to-expect-when-using-proximity-placement-groups"></a>近接通信配置グループを使用する場合に予期されること 
近接配置グループでは、同じデータ センターでのコロケーションが提供されます。 しかし、近接配置グループは追加のデプロイ制約を表すため、割り当てエラーが発生する可能性があります。 近接配置グループを使用しているときに、割り当てエラーが発生する可能性があるユース ケースをいくつか以下に示します。

- 近接配置グループ内の最初の仮想マシンを要求すると、自動的にデータ センターが選択されます。 場合によっては、別の仮想マシン SKU (そのデータ センターに存在しない場合) の 2 番目の要求が失敗することがあります。 この場合、**OverconstrainedAllocationRequest** エラーが返されます。 これを回避するには、SKU をデプロイする順序を変更してみるか、単一の ARM テンプレートを使用して両方のリソースをデプロイします。
-   VM インスタンスを追加および削除する、エラスティック ワークロードの場合、デプロイに近接配置グループの制約があると、要求を満たすことができず、**AllocationFailure** エラーになる可能性があります。 
- 必要に応じて VM を停止 (割り当て解除) して起動することが、エラスティック性を実現するためのもう 1 つの方法です。 VM を停止 (割り当て解除) した後は容量が保持されないため、VM を再度起動すると、**AllocationFailure** エラーが発生する可能性があります。


## <a name="best-practices"></a>ベスト プラクティス 
- 最も短い待ち時間を実現するには、近接通信配置グループを高速ネットワークと共に使用します。 詳細については、「[高速ネットワークを使った Linux 仮想マシンの作成](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-cli?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)」または「[高速ネットワークを使った Windows 仮想マシンの作成](/azure/virtual-network/create-vm-accelerated-networking-powershell?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)」を参照してください。
- すべての VM サイズを 1 つのテンプレートでデプロイします。 必要な VM SKU とサイズの一部がサポートされていないハードウェアに配置されることを回避するには、すべてのアプリケーション層を 1 つのテンプレートに含めて、すべてが同時にデプロイされるようにします。
- PowerShell、CLI、または SDK を使用してデプロイのスクリプトを作成している場合は、割り当てエラー `OverconstrainedAllocationRequest` が表示されることがあります。 この場合は、既存のすべての VM を停止して割り当てを解除し、デプロイ スクリプト内のシーケンスを、失敗した VM SKU/サイズで始まるように変更する必要があります。 
- VM が削除された既存の配置グループを再利用する場合は、その削除が完全に完了するまで待ってから VM を追加してください。
- 待ち時間が最優先事項である場合は、VM を近接通信配置グループ内に、ソリューション全体を可用性ゾーン内に配置します。 ただし、回復性が最優先事項である場合は、インスタンスを複数の可用性ゾーンにわたって分散させます (1 つの近接通信配置グループがゾーンにまたがることはできません)。
